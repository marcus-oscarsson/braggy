{"version":3,"sources":["app/imageview/full-data-download.worker.js","app/imageview/preview-data-download.worker.js","app/file-browser/file-browser-actions.js","app/utils/buffer.js","app/imageview/imageview-actions.js","app/app-actions.js","app/redux-store.js","app/root-reducer.js","views/file-browser/FileBrowser.jsx","views/imageview/ImageView.js","views/imageview/ReactImageView.jsx","views/main/Drawer.jsx","views/main/Main.jsx","serviceWorker.js","app/utils/utils.js","index.jsx"],"names":["module","exports","Worker","__webpack_require__","p","API_URL","createActions","SET_CONTENT","files","SET_LOADING","loading","SET_SELECTED_FILE","path","SET_RANGE","op","arguments","length","undefined","prefix","setContent","setLoading","setSelectedFile","file_browser_actions","handleActions","_handleActions","Object","defineProperty","state","_ref","payload","objectSpread","_ref2","_ref3","selectedFile","pageSize","currentRange","listDirRequest","dispatch","axios","post","concat","then","response","data","items","catch","error","initFileBrowserRequest","get","buffer","ImageBuffer","_this","this","size","classCallCheck","add","key","prop","value","keys","o","push","onOverflow","del","filter","item","onMiss","pop","createClass","initialState","images","currentImage","imageScale","options","showResolution","autoScale","aggDownload","downloadFull","showFullData","valueRange","valueRangeLimit","availableCmaps","viridis","plasma","magma","inferno","temperature","grey","deadpixels","currentCmap","INIT","SET_AND_ADD_IMAGE","hdr","ADD_IMAGE","SET_CURRENT_IMAGE","SET_OPTION","init","setAndAddImage","addImage","setCurrentImage","setOption","ImageViewReducer","_ImageViewReducer","_ref$payload","_ref2$payload","_ref4","_ref4$payload","imageview_actions","fetchImageRequest","getState","follow","app","imageView","imageBuffer","braggy_hdr","window","previewDataDownloadWorker","postMessage","fullDataDownloadWorker","SET_FOLLOW","wavelength","detector_distance","detector_radius","app_actions","action","type","detectorDistance","detectorRadious","detectorRadius","history","createHistory","middleware","thunk","routerMiddleware","logger","composedEnhancers","compose","apply","applyMiddleware","store","createStore","combineReducers","router","connectRouter","fileBrowser","mm","require","FileBrowser","props","possibleConstructorReturn","getPrototypeOf","call","filterTerm","listItemOnClick","bind","assertThisInitialized","filterInputOnChange","fileData","_this$props","onFileClick","isLeaf","fpath","_this2","_this$props2","downloadedFiles","classes","file","s","term","res","isMatch","text","slice","map","react_default","a","createElement","ListItem","button","selected","onClick","ListItemIcon","className","downloadedItem","Image_default","Folder_default","ListItemText","primary","CircularProgress","disableShrink","progress","e","setState","target","_this$props3","setRange","incEnabled","decEnabled","fileNavContainer","Button","disabled","margin","_this$props4","List","ListSubheader","component","style","background","Input","placeholder","input","inputProps","aria-label","onChange","scrollContainer","busyIndicator","showFiles","fileNavigation","React","Component","connect","bindActionCreators","FileBrowserActions","withStyles","theme","overflow","marginLeft","marginBottom","spacing","unit","textAlign","marginRight","display","top","bottom","color","withTheme","IMAGE_VIEW_REGISTRY","getImageView","name","StdShader","cmaps","greywithred","uniforms","vertexShader","join","fragmentShader","RGBShader","InfoDiv","show","dom","hide","setPosition","x","y","left","document","assign","position","padding","border-radius","user-select","pointer-events","addEventListener","id","ImageView","setImageHdr","beamCX","beamCY","pxppmX","pxppmY","min","max","mean","std","imageHDR","pxpmmX","pxpmmY","setValueRange","cmap_min","cmap_max","dataMaterial","needsUpdate","scene","render","setValueLimitRange","valueLimitRange","setColormap","cmap","showDiffractionRings","renderRings","diffraction_rings","forEach","ring","z","container","mouseOverInfoDiv","appendChild","initD3","initThree","clientWidth","clientHeight","initPanAndZoom","renderer","domElement","handleMouseMove","d3","append","attr","d3Container","width","height","THREE","setSize","setPixelRatio","devicePixelRatio","stats","Stats","right","camera","set","animateThree","d3zoom","scaleExtent","on","event","sourceEvent","newZ","transform","k","zoom","updateProjectionMatrix","_event$sourceEvent","movementX","movementY","d3view","rect","getBoundingClientRect","clientX","Math","floor","clientY","raycaster","mouse","setFromCamera","intersects","intersectObjects","children","uv","obj","imageX","imageWidth","imageY","imageHeight","i","intensity","dd","dhalf","sqrt","PI","sin","atan","resolutionAt","toFixed","innerHTML","scale","scaleTo","resetScale","relativeScale","update","requestAnimationFrame","createUVMapping","geometry","computeBoundingBox","boundingBox","offset","range","faceVertexUvs","faces","v1","vertices","v2","b","v3","c","uvsNeedUpdate","createGlCricle","r","xo","yo","dashMaterial","linewidth","circleGeom","circle","shift","renderImageData","dtype","clearThree","dispose","rectShape","moveTo","lineTo","threeDtype","threeFormat","shader","dataTexture","flipY","wrapS","wrapT","magFilter","minFilter","transparent","mesh","center","createDiffractionRings","rawDataBuffer","imgHeader","beam_ocx","beam_ocy","pxxpm","pxypm","img_width","img_height","currentScale","remove","material","texture","_this3","glRings","dr","ddr","resRings","resolutionRings","VIEWS","ReactImageView","availableColormaps","renderToolBox","toolboxVisible","tbox","ListGroup","variant","Item","Row","Col","xs","Form","Group","Check","checked","label","forceUpdate","Control","as","selectedIndex","Label","rc_slider_es","Range","marks","step","react_numeric_input_default","v","parseInt","Number","isNaN","canvasContainerRef","createRef","current","index_esm","ref","ResponsiveDrawer","log10","log","pow10","pow","valueLabelFormat","_this$pow10$toExponen","toExponential","split","_this$pow10$toExponen2","slicedToArray","coefficient","exponent","round","currentImagePath","drawer","file_browser_FileBrowser","root","CssBaseline","SwipeableDrawer","anchor","paper","drawerPaper","open","Snackbar","snackBar","onClose","handleClose","TransitionComponent","Fade","ContentProps","aria-describedby","message","content","imageViewContainer","ReactImageView_ReactImageView","ImageViewActions","appBar","zIndex","optionsForm","toolbar","mixins","menuButton","Main","Route","exact","Drawer","Boolean","location","hostname","match","socket","io","domain","port","console","DownloadWorker","DataWorker","onmessage","rawData","rgbData","initApp","querySelector","es","esm","main_Main","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.40fb7864.chunk.js","sourcesContent":["module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"ae99941c269e3174f6f0.worker.js\");\n};","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"30c8cb5688584303b15f.worker.js\");\n};","import { createActions, handleActions } from 'redux-actions';\nimport axios from 'axios';\n\nconst API_URL = '/api/file-browser';\n\nconst initialState = {\n  files: [],\n  selectedFile: '',\n  loading: false,\n  pageSize: 10,\n  currentRange: [0, 14]\n};\n\nexport const {\n  setContent,\n  setLoading,\n  setSelectedFile,\n} = createActions({\n  SET_CONTENT: files => ({ files }),\n  SET_LOADING: loading => ({ loading }),\n  SET_SELECTED_FILE: path => ({ path }),\n  SET_RANGE: (op = 'inc') => ({ op }),\n}, { prefix: 'filebrowser' });\n\nexport default handleActions(\n  {\n    [setContent]: (\n      state,\n      { payload: { files } }\n    ) => ({ ...state, files }),\n    [setLoading]: (\n      state,\n      { payload: { loading } }\n    ) => ({ ...state, loading }),\n    [setSelectedFile]: (\n      state,\n      { payload: { path } }\n    ) => ({ ...state, selectedFile: path }),\n  },\n  initialState\n);\n\n// REST API\nexport function listDirRequest(path) {\n  return (dispatch) => {\n    dispatch(setLoading(true));\n    axios.post(`${API_URL}/list-dir`, { path })\n      .then((response) => {\n        dispatch(setContent(response.data.items));\n        dispatch(setLoading(false));\n      })\n      .catch((error) => {\n        throw (error);\n      })\n      .catch(() => {\n        dispatch(setLoading(false));\n      });\n  };\n}\n\nexport function initFileBrowserRequest() {\n  return (dispatch) => {\n    dispatch(setLoading(true));\n    axios.get(`${API_URL}/init`)\n      .then((response) => {\n        dispatch(setContent(response.data.items));\n      })\n      .catch((error) => {\n        throw (error);\n      })\n      .then(() => {\n        dispatch(setLoading(false));\n      });\n  };\n}\n","export class ImageBuffer {\n  constructor(size = 20) {\n    this.buffer = {};\n    this.keys = [];\n    this.size = size;\n    this.onOverflow = null;\n    this.onMiss = null;\n  }\n\n  has(key) {\n    return key in this.buffer;\n  }\n\n  add = (key, prop, value) => {\n    if (this.keys.length < this.size) {\n      const o = (key in this.buffer) ? this.buffer[key] : {};\n      o[prop] = value;\n      this.buffer[key] = o;\n\n      if (!(key in this.buffer)) {\n        this.keys.push(key);\n      }\n    } else if (this.onOverflow !== null) {\n      this.onOverflow(key, value);\n    }\n  }\n\n  del = (key) => {\n    this.keys = this.keys.filter(item => (item !== key));\n    delete this.buffer[key];\n  }\n\n  get = (key) => {\n    const value = this.buffer[key];\n\n    if (value === undefined && this.onMiss !== null) {\n      this.onMiss(key);\n    }\n\n    return value;\n  }\n\n  pop = () => {\n    if (Object.keys(this.buffer).length === this.size) {\n      const key = this.keys[0];\n      this.del(key);\n    }\n  }\n}\n\nexport default new ImageBuffer();\n","import { createActions, handleActions } from 'redux-actions';\nimport axios from 'axios';\n\nimport imageBuffer from 'app/utils/buffer';\n\nconst API_URL = '/api/imageview';\n\nconst initialState = {\n  images: {},\n  currentImage: '',\n  imageScale: 1,\n  options: {\n    showResolution: true,\n    autoScale: true,\n    aggDownload: true,\n    downloadFull: true,\n    showFullData: false,\n    valueRange: [-2, 10],\n    valueRangeLimit: [-2, 10, 5],\n    availableCmaps: {\n      viridis: 0,\n      plasma: 1,\n      magma: 2,\n      inferno: 3,\n      temperature: 4,\n      grey: 5,\n      deadpixels: 6,\n    },\n    currentCmap: 'viridis'\n  }\n};\n\nexport const {\n  init,\n  setAndAddImage,\n  addImage,\n  setCurrentImage,\n  setOption,\n} = createActions({\n  INIT: () => ({ ...initialState }),\n  SET_AND_ADD_IMAGE: (path, hdr) => ({ path, hdr }),\n  ADD_IMAGE: (path, hdr) => ({ path, hdr }),\n  SET_CURRENT_IMAGE: path => ({ path }),\n  SET_OPTION: (key, value) => ({ key, value }),\n}, { prefix: 'imageview' });\n\nexport const ImageViewReducer = {\n  [init]: () => (\n    { ...initialState }\n  ),\n\n  [setAndAddImage]: (state, { payload: { path, hdr } }) => (\n    { ...state, images: { ...state.images, [path]: { hdr } }, currentImage: path }\n  ),\n\n  [addImage]: (state, { payload: { path, hdr } }) => (\n    { ...state, images: { ...state.images, [path]: { hdr } } }\n  ),\n\n  [setCurrentImage]: (state, { payload: { path } }) => (\n    { ...state, currentImage: path }\n  ),\n\n  [setOption]: (state, { payload: { key, value } }) => (\n    { ...state, options: { ...state.options, [key]: value } }\n  )\n};\n\nexport default handleActions(\n  ImageViewReducer,\n  initialState\n);\n\n// REST API\nexport function fetchImageRequest(path) {\n  return (dispatch, getState) => {\n    const { follow } = getState().app;\n    const { downloadFull } = getState().imageView.options;\n\n    axios.post(`${API_URL}/preload`, { path })\n      .then((response) => {\n        const hdr = response.data;\n        imageBuffer.add(path, 'hdr', hdr.braggy_hdr);\n        window.previewDataDownloadWorker.postMessage({ path, hdr });\n\n        if (!follow && downloadFull) {\n          window.fullDataDownloadWorker.postMessage({ path });\n        }\n      })\n      .catch((error) => {\n        throw (error);\n      });\n  };\n}\n","export const INIT = 'app/INIT';\nexport const SET_FOLLOW = 'app/SET_FOLLOW';\n\nconst initialState = {\n  follow: false,\n  wavelength: null,\n  detector_distance: null,\n  detector_radius: null\n};\n\n\nexport default (state = initialState, action) => {\n  switch (action.type) {\n    case INIT:\n      return {\n        ...initialState\n      };\n    case SET_FOLLOW:\n      return {\n        ...state,\n        follow: action.follow,\n        detectorDistance: action.detectorDistance,\n        wavelength: action.wavelength,\n        detectorRadious: action.detectorRadius\n      };\n    default:\n      return state;\n  }\n};\n\n\nexport function setFollow(follow, wavelength, detectorDistance, detectorRadius) {\n  return (dispatch) => {\n    dispatch({\n      type: SET_FOLLOW,\n      follow,\n      detectorDistance,\n      detectorRadius,\n      wavelength\n    });\n  };\n}\n","/* eslint-disable no-underscore-dangle */\n\nimport { createStore, applyMiddleware, compose } from 'redux';\nimport { routerMiddleware } from 'connected-react-router';\nimport logger from 'redux-logger';\nimport thunk from 'redux-thunk';\nimport createHistory from 'history/createBrowserHistory';\nimport createRootReducer from 'app/root-reducer';\n\nexport const history = createHistory();\n\nconst initialState = {};\nconst enhancers = [];\n\n// Logger MUST BE the last middleware\nconst middleware = [\n  thunk,\n  routerMiddleware(history),\n  logger\n];\n\nif (process.env.NODE_ENV === 'development') {\n  const devToolsExtension = window.__REDUX_DEVTOOLS_EXTENSION__;\n\n  if (typeof devToolsExtension === 'function') {\n    enhancers.push(devToolsExtension());\n  }\n}\n\nconst composedEnhancers = compose(\n  applyMiddleware(...middleware),\n  ...enhancers\n);\n\n\nconst store = createStore(\n  createRootReducer(history),\n  initialState,\n  composedEnhancers\n);\n\nexport default store;\n","import { combineReducers } from 'redux';\nimport { connectRouter } from 'connected-react-router';\nimport fileBrowser from 'app/file-browser/file-browser-actions';\nimport imageView from 'app/imageview/imageview-actions';\nimport app from 'app/app-actions';\n\n\nexport default function createRootReducer(history) {\n  return combineReducers({\n    router: connectRouter(history),\n    app,\n    fileBrowser,\n    imageView\n  });\n}\n","import React from 'react';\nimport List from '@material-ui/core/List';\nimport ListSubheader from '@material-ui/core/ListSubheader';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Button from '@material-ui/core/Button';\nimport FolderIcon from '@material-ui/icons/Folder';\nimport ImageIcon from '@material-ui/icons/Image';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Input from '@material-ui/core/Input';\nimport { withStyles } from '@material-ui/core/styles';\n\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\n\n\nimport * as FileBrowserActions from 'app/file-browser/file-browser-actions';\n\nconst mm = require('micromatch');\n\nconst styles = theme => ({\n  scrollContainer: {\n    overflow: 'auto'\n  },\n  input: {\n    marginLeft: '1px',\n    marginBottom: theme.spacing.unit * 2\n  },\n  fileNavContainer: {\n    textAlign: 'center'\n  },\n  progress: {\n    marginLeft: 'auto',\n    marginRight: 'auto',\n    display: 'block',\n    top: '50%',\n    bottom: '50%'\n  },\n  downloadedItem: {\n    color: '#307fd6'\n  },\n  item: {\n  }\n});\n\n\nfunction filter(s, term) {\n  let res = true;\n\n  if (term) {\n    res = mm.isMatch(s, `${term}*`);\n  }\n\n  return res;\n}\n\nclass FileBrowser extends React.Component {\n  state = {\n    filterTerm: ''\n  };\n\n  constructor(props) {\n    super(props);\n    this.listItemOnClick = this.listItemOnClick.bind(this);\n    this.filterInputOnChange = this.filterInputOnChange.bind(this);\n  }\n\n  listItemOnClick(fileData) {\n    const { listDirRequest, onFileClick, setSelectedFile } = this.props;\n\n    if (fileData.isLeaf) {\n      setSelectedFile(fileData.fpath);\n      onFileClick(fileData.fpath);\n    } else {\n      listDirRequest(fileData.fpath);\n    }\n  }\n\n  showFiles() {\n    const {\n      files,\n      selectedFile,\n      currentRange,\n      downloadedFiles,\n      classes\n    } = this.props;\n    const { filterTerm } = this.state;\n\n    return files\n      .filter(file => filter(file.text, filterTerm))\n      .slice(currentRange[0], currentRange[1])\n      .map(file => (\n        <ListItem\n          button\n          key={file.text}\n          selected={file.fpath === selectedFile}\n          onClick={() => this.listItemOnClick(file)}\n        >\n          <ListItemIcon\n            className={file.fpath in downloadedFiles ? classes.downloadedItem : classes.item}\n          >\n            {file.isLeaf ? <ImageIcon /> : <FolderIcon />}\n          </ListItemIcon>\n          <ListItemText primary={file.text} />\n        </ListItem>));\n  }\n\n  busyIndicator() {\n    const { classes } = this.props;\n\n    return (<CircularProgress disableShrink className={classes.progress} />);\n  }\n\n  filterInputOnChange(e) {\n    this.setState({ filterTerm: e.target.value });\n  }\n\n  fileNavigation() {\n    const {\n      files,\n      pageSize,\n      currentRange,\n      setRange,\n      classes\n    } = this.props;\n\n    let incEnabled = true;\n    let decEnabled = true;\n\n    if (files.length > pageSize && currentRange[0] === 0) {\n      decEnabled = false;\n    } else if (files.length > pageSize && currentRange[1] > files.length) {\n      incEnabled = false;\n    } else if (files.length < pageSize) {\n      decEnabled = false;\n      incEnabled = false;\n    }\n\n    return (\n      <div className={classes.fileNavContainer}>\n        <Button size=\"small\" disabled={!decEnabled} className={classes.margin} onClick={() => setRange('dec')}>\n          PREV\n        </Button>\n        <Button size=\"small\" disabled={!incEnabled} className={classes.margin} onClick={() => setRange('inc')}>\n          NEXT\n        </Button>\n      </div>);\n  }\n\n  render() {\n    const { classes, loading } = this.props;\n\n    return (\n      <div>\n        <List>\n          <ListSubheader component=\"div\" style={{ background: '#FFF' }}>\n            <div>\n              <Input\n                placeholder=\"Search\"\n                className={classes.input}\n                inputProps={{ 'aria-label': 'Filter' }}\n                onChange={this.filterInputOnChange}\n              />\n            </div>\n          </ListSubheader>\n          <div className={classes.scrollContainer}>\n            { loading ? this.busyIndicator() : this.showFiles()}\n          </div>\n        </List>\n        { this.fileNavigation() }\n      </div>\n    );\n  }\n}\n\n\nfunction mapStateToProps({ fileBrowser }) {\n  return {\n    files: fileBrowser.files,\n    loading: fileBrowser.loading,\n    selectedFile: fileBrowser.selectedFile,\n    currentRange: fileBrowser.currentRange,\n    pageSize: fileBrowser.pageSize\n  };\n}\n\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators(FileBrowserActions, dispatch);\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(\n  withStyles(styles, { withTheme: true })(FileBrowser)\n);\n","import * as THREE from 'three-full';\nimport Stats from 'stats.js';\nimport * as d3 from 'd3';\n\nconst IMAGE_VIEW_REGISTRY = {};\n\nexport function getImageView(name) {\n  return IMAGE_VIEW_REGISTRY[name];\n}\n\n/* eslint-disable */\nexport const StdShader = {\n  cmaps: {\n    'viridis': 0,\n    'plasma': 1,\n    'magma': 2,\n    'inferno': 3,\n    'temperature': 4,\n    'grey': 5,\n    'greywithred': 6,\n  },\n  uniforms: {\n  },\n  vertexShader: [\n    'varying vec2 vUv;',\n    'void main() {',\n       'vUv = uv;',\n       'gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n    '}'\n  ].join('\\n'),\n  fragmentShader: [\n    'uniform sampler2D data;',\n    'varying vec2 vUv;',\n    'uniform float cmap_min;',\n    'uniform float cmap_max;',\n    'uniform int cmap;',\n\n    'float normValue(float val) {',\n        'float normValue = clamp((val - cmap_min)/(cmap_max - cmap_min), 0.0, 1.0);',\n        'return normValue;',\n    '}',\n\n    'vec3 viridis(float t) {',\n        'const vec3 c0 = vec3(0.2777273272234177, 0.005407344544966578, 0.3340998053353061);',\n        'const vec3 c1 = vec3(0.1050930431085774, 1.404613529898575, 1.384590162594685);',\n        'const vec3 c2 = vec3(-0.3308618287255563, 0.214847559468213, 0.09509516302823659);',\n        'const vec3 c3 = vec3(-4.634230498983486, -5.799100973351585, -19.33244095627987);',\n        'const vec3 c4 = vec3(6.228269936347081, 14.17993336680509, 56.69055260068105);',\n        'const vec3 c5 = vec3(4.776384997670288, -13.74514537774601, -65.35303263337234);',\n        'const vec3 c6 = vec3(-5.435455855934631, 4.645852612178535, 26.3124352495832);',\n        'return c0+t*(c1+t*(c2+t*(c3+t*(c4+t*(c5+t*c6)))));',\n    '}',\n\n    'vec3 plasma(float t) {',\n\n      'const vec3 c0 = vec3(0.05873234392399702, 0.02333670892565664, 0.5433401826748754);',\n      'const vec3 c1 = vec3(2.176514634195958, 0.2383834171260182, 0.7539604599784036);',\n      'const vec3 c2 = vec3(-2.689460476458034, -7.455851135738909, 3.110799939717086);',\n      'const vec3 c3 = vec3(6.130348345893603, 42.3461881477227, -28.51885465332158);',\n      'const vec3 c4 = vec3(-11.10743619062271, -82.66631109428045, 60.13984767418263);',\n      'const vec3 c5 = vec3(10.02306557647065, 71.41361770095349, -54.07218655560067);',\n      'const vec3 c6 = vec3(-3.658713842777788, -22.93153465461149, 18.19190778539828);',\n  \n      'return c0+t*(c1+t*(c2+t*(c3+t*(c4+t*(c5+t*c6)))));',\n    '}',\n\n    'vec3 magma(float t) {',\n  \n      'const vec3 c0 = vec3(-0.002136485053939582, -0.000749655052795221, -0.005386127855323933);',\n      'const vec3 c1 = vec3(0.2516605407371642, 0.6775232436837668, 2.494026599312351);',\n      'const vec3 c2 = vec3(8.353717279216625, -3.577719514958484, 0.3144679030132573);',\n      'const vec3 c3 = vec3(-27.66873308576866, 14.26473078096533, -13.64921318813922);',\n      'const vec3 c4 = vec3(52.17613981234068, -27.94360607168351, 12.94416944238394);',\n      'const vec3 c5 = vec3(-50.76852536473588, 29.04658282127291, 4.23415299384598);',\n      'const vec3 c6 = vec3(18.65570506591883, -11.48977351997711, -5.601961508734096);',\n  \n      'return c0+t*(c1+t*(c2+t*(c3+t*(c4+t*(c5+t*c6)))));',\n    '}',\n  \n    'vec3 inferno(float t) {',\n\n      'const vec3 c0 = vec3(0.0002189403691192265, 0.001651004631001012, -0.01948089843709184);',\n      'const vec3 c1 = vec3(0.1065134194856116, 0.5639564367884091, 3.932712388889277);',\n      'const vec3 c2 = vec3(11.60249308247187, -3.972853965665698, -15.9423941062914);',\n      'const vec3 c3 = vec3(-41.70399613139459, 17.43639888205313, 44.35414519872813);',\n      'const vec3 c4 = vec3(77.162935699427, -33.40235894210092, -81.80730925738993);',\n      'const vec3 c5 = vec3(-71.31942824499214, 32.62606426397723, 73.20951985803202);',\n      'const vec3 c6 = vec3(25.13112622477341, -12.24266895238567, -23.07032500287172);',\n  \n      'return c0+t*(c1+t*(c2+t*(c3+t*(c4+t*(c5+t*c6)))));',\n    '}',\n\n    'vec3 temperature(float t) {',\n        'float red = clamp(4. * t - 2., 0., 1.);',\n        'float green = 1. - clamp(4. * abs(t - 0.5) - 1., 0., 1.);',\n        'float blue = 1. - clamp(4. * t - 1., 0., 1.);',\n        'return vec3(red, green, blue);',\n    '}',\n\n    'vec3 grey(float t) {',\n        'float red = (1.0 - t);',\n        'float green = (1.0 - t);',\n        'float blue = (1.0 - t);',\n        'return vec3(red, green, blue);',\n    '}',\n\n    'vec3 greywithred(float t) {',\n        'float red;',\n        'float green;',\n        'float blue;',\n        'float normT = normValue(t);',\n\n        'if (t < 0.0) {',\n            'red = 1.0;',\n            'green = normT;',\n            'blue = normT;',\n        '} else {',\n            'red = (1.0 - normT);',\n            'green = (1.0 - normT);',\n            'blue = (1.0 - normT);',\n        '}',\n\n        'return vec3(red, green, blue);',\n    '}',\n\n    'void main() {',\n        'vec4 color = texture2D(data, vUv);',\n        'vec4 c;',\n        'if (cmap == 0) {',\n            'c = vec4(viridis(normValue(color.r)).rgb, color.a);',\n        '} else if (cmap == 1) {',\n            'c = vec4(plasma(normValue(color.r)).rgb, color.a);',\n        '} else if (cmap == 2) {',\n            'c = vec4(magma(normValue(color.r)).rgb, color.a);',\n        '} else if (cmap == 3) {',\n            'c = vec4(inferno(normValue(color.r)).rgb, color.a);',\n        '} else if (cmap == 4) {',\n            'c = vec4(temperature(normValue(color.r)).rgb, color.a);',\n        '} else if (cmap == 5) {',\n            'c = vec4(grey(normValue(color.r)).rgb, color.a);',\n        '} else if (cmap == 6) {',\n            'c = vec4(greywithred(color.r).rgb, color.a);',\n        '} else  {',\n            'c = vec4(viridis(normValue(color.r)).rgb, color.a);',\n        '}',\n        'gl_FragColor = c;',\n    '}'\n  ].join('\\n')\n};\n\nexport const RGBShader = {\n  uniforms: {\n  },\n  vertexShader: [\n    'varying vec2 vUv;',\n    'void main() {',\n       'vUv = uv;',\n       'gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n    '}'\n  ].join('\\n'),\n  fragmentShader: [\n    'uniform sampler2D data;',\n    'varying vec2 vUv;',\n\n    'void main() {',\n        'vec4 color = texture2D(data, vUv);',\n        'vec3 c = color.rgb;',\n        'c.r = color.r;',\n        'c.g = color.g;',\n        'c.b = color.b;',\n        'gl_FragColor = vec4(c.rgb, color.a);',\n    '}'\n  ].join('\\n')\n};\n\nexport const SepiaShader = {\n  uniforms: {\n    tDiffuse: { value: null },\n    amount: { value: 1.0 },\n  },\n  vertexShader: [\n    'varying vec2 vUv;',\n    'void main() {',\n        'vUv = uv;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n    '}'\n  ].join('\\n'),\n  fragmentShader: [\n    'uniform float amount;',\n    'uniform sampler2D data;',\n    'uniform float cmap_min;',\n    'uniform float cmap_max;',\n    'varying vec2 vUv;',\n\n    'void main() {',\n        'vec4 color = texture2D(data, vUv);',\n        'vec3 c = color.rgb;',\n        'color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );',\n        'color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );',\n        'color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );',\n        'gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );',\n    '}'\n  ].join('\\n')\n};\n\n/* eslint-enable */\n\nclass InfoDiv {\n  constructor(className) {\n    this.dom = document.createElement('span');\n\n    Object.assign(this.dom.style, {\n      position: 'absolute',\n      background: 'rgba(0, 0, 0, 0.6)',\n      padding: '0.5em',\n      'border-radius': '4px',\n      color: 'rgba(255, 255, 255, 1)',\n      display: 'inline',\n      'user-select': 'none',\n      'pointer-events': 'none'\n    });\n\n    this.dom.className = className;\n\n    window.addEventListener('mousemove', (e) => {\n      if (e.target.id !== 'imageview-canvas') {\n        this.hide();\n      }\n    });\n  }\n\n  show = () => {\n    this.dom.style.display = 'inline';\n  }\n\n  hide = () => {\n    this.dom.style.display = 'none';\n  }\n\n  setPosition = (x, y) => {\n    this.dom.style.left = `${x}px`;\n    this.dom.style.top = `${y}px`;\n  }\n}\n\nfunction resolutionAt(x, y, dd, wavelength) {\n  const dhalf = Math.sqrt(x * x + y * y) * Math.PI;\n  return wavelength / (2 * Math.sin(0.5 * Math.atan(dhalf / dd)));\n}\n\nfunction resolutionRings(dr, dd, wavelength, ddr = 0.03, sr = 0.01) {\n  const resRings = [];\n\n  for (let r = sr; r <= dr; r += ddr) {\n    const dhalf = r * Math.PI;\n    const res = wavelength / (2 * Math.sin(0.5 * Math.atan(dhalf / dd)));\n    resRings.push({ r, res });\n  }\n\n  return resRings;\n}\n\nexport default class ImageView {\n  static VIEWS = {};\n\n  constructor(name = 'default') {\n    IMAGE_VIEW_REGISTRY[name] = this;\n\n    this.shader = StdShader;\n    this.cmap_min = 0;\n    this.cmap_max = 1;\n    this.cmap = 0;\n    this.valueLimitRange = [0, 0];\n    this.renderRings = false;\n\n    this.data = null;\n    this.imageWidth = null;\n    this.imageHeight = null;\n    this.imageHDR = {\n      beamCX: 0,\n      beamCY: 0,\n      pxpmmX: 0,\n      pxpmmY: 0,\n      detector_distance: 0,\n      detector_radius: 0,\n      wavelength: 0,\n      min: 0,\n      max: 0,\n      mean: 0,\n      std: 0,\n    };\n\n    this.width = null;\n    this.height = null;\n    this.currentScale = null;\n\n    this.stats = null;\n    this.scene = null;\n    this.camera = null;\n    this.renderer = null;\n\n    this.d3view = null;\n    this.d3Container = null;\n  }\n\n  setImageHdr = (beamCX, beamCY, pxppmX, pxppmY,\n    detectorDistance, detectorRadius, wavelength,\n    min, max, mean, std) => {\n    this.imageHDR.beamCX = beamCX;\n    this.imageHDR.beamCY = beamCY;\n    this.imageHDR.pxpmmX = pxppmX;\n    this.imageHDR.pxpmmY = pxppmY;\n    this.imageHDR.detector_distance = detectorDistance;\n    this.imageHDR.detector_radius = detectorRadius;\n    this.imageHDR.wavelength = wavelength;\n    this.imageHDR.min = min;\n    this.imageHDR.max = max;\n    this.imageHDR.mean = mean;\n    this.imageHDR.std = std;\n  }\n\n  setValueRange = (min, max) => {\n    this.cmap_min = min;\n    this.cmap_max = max;\n\n    if (this.dataMaterial) {\n      this.dataMaterial.uniforms.cmap_min.value = min;\n      this.dataMaterial.uniforms.cmap_max.value = max;\n      this.dataMaterial.needsUpdate = true;\n      this.scene.needsUpdate = true;\n      this.render.needsUpdate = true;\n    }\n  }\n\n  setValueLimitRange = (min, max) => {\n    this.valueLimitRange = [min, max];\n  }\n\n  setColormap = (cmap) => {\n    this.cmap = cmap;\n\n    if (this.dataMaterial) {\n      this.dataMaterial.uniforms.cmap.value = cmap;\n      this.dataMaterial.needsUpdate = true;\n      this.scene.needsUpdate = true;\n      this.render.needsUpdate = true;\n    }\n  }\n\n  showDiffractionRings = (value) => {\n    this.renderRings = value;\n\n    this.diffraction_rings.forEach((ring) => {\n      ring.position.z = value ? 1 : -1;\n      ring.needsUpdate = true;\n    });\n\n    this.scene.needsUpdate = true;\n  }\n\n  init = (container) => {\n    this.container = container;\n\n    this.mouseOverInfoDiv = new InfoDiv('imgeview-info-div');\n    this.container.appendChild(this.mouseOverInfoDiv.dom);\n\n    this.initD3();\n    this.initThree(this.container.clientWidth, this.container.clientHeight);\n    this.initPanAndZoom();\n\n    this.renderer.domElement.addEventListener('mousemove', (e) => {\n      this.handleMouseMove(e);\n    });\n  }\n\n  initD3 = () => {\n    d3.select(this.container)\n      .append('svg')\n      .attr('id', 'd3-container')\n      .attr('width', this.container.clientWidth)\n      .attr('height', this.container.clientHeight)\n      .attr('style', 'position: absolute; pointer-events: none;');\n\n    this.d3Container = d3.select('#d3-container');\n  }\n\n  initThree = (width, height) => {\n    // Three JS canvas\n    this.renderer = new THREE.WebGLRenderer();\n    this.width = width;\n    this.height = height;\n    this.renderer.setSize(width, height);\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.container.appendChild(this.renderer.domElement);\n    this.renderer.domElement.id = 'imageview-canvas';\n\n    // Add stats box\n    this.stats = new Stats();\n    this.stats.dom.style.position = 'absolute';\n    this.stats.dom.style.bottom = '0px';\n    this.stats.dom.style.right = '0px';\n    this.stats.dom.style.left = null;\n    this.stats.dom.style.top = null;\n\n    this.container.appendChild(this.stats.dom);\n\n    // Set up camera and scene\n    this.camera = new THREE.OrthographicCamera(\n      0,\n      width,\n      height,\n      0,\n      0,\n      1000\n    );\n\n    this.camera.position.set(0, 0, 100);\n    this.scene = new THREE.Scene();\n    this.scene.background = new THREE.Color(0xffffff);\n    this.animateThree();\n  }\n\n  initPanAndZoom = () => {\n    this.d3zoom = d3.zoom()\n      .scaleExtent([0, 10000])\n      .on('zoom', () => {\n        const { event } = d3;\n        if (event.sourceEvent) {\n          const newZ = event.transform.k;\n\n          if (newZ !== this.camera.zoom) {\n            this.camera.zoom = newZ;\n            this.camera.updateProjectionMatrix();\n          } else {\n            const { movementX, movementY } = event.sourceEvent;\n\n            this.camera.position.set(\n              this.camera.position.x - movementX,\n              this.camera.position.y + movementY,\n              this.camera.position.z\n            );\n          }\n\n          this.camera.needsUpdate = true;\n        }\n      });\n\n    // Add zoom listener\n    this.d3view = d3.select(this.renderer.domElement);\n    this.d3view.call(this.d3zoom);\n  }\n\n  handleMouseMove = (e) => {\n    const rect = this.renderer.domElement.getBoundingClientRect();\n    const x = e.clientX - Math.floor(rect.x);\n    const y = e.clientY - Math.floor(rect.y);\n\n    const raycaster = new THREE.Raycaster();\n    const mouse = new THREE.Vector2();\n\n    mouse.x = (x / rect.width) * 2 - 1;\n    mouse.y = -(y / rect.height) * 2 + 1;\n\n    // update the picking ray with the camera and mouse position\n    raycaster.setFromCamera(mouse, this.camera);\n\n    // calculate objects intersecting the picking ray\n    const intersects = raycaster.intersectObjects(this.scene.children);\n\n    this.mouseOverInfoDiv.hide();\n\n    if (intersects.length > 0 && intersects[0].uv !== undefined) {\n      /* eslint no-bitwise:0 */\n      /* eslint no-mixed-operators:0 */\n      const obj = intersects[0];\n\n      const imageX = Math.floor(obj.uv.x * this.imageWidth);\n      const imageY = Math.floor((1 - obj.uv.y) * this.imageHeight);\n      const i = (imageY * this.imageWidth + imageX);\n      const intensity = this.data[i];\n\n      const cx = ((this.imageWidth / 2 + this.imageHDR.beamCX) - imageX) / this.imageHDR.pxpmmX;\n      const cy = ((this.imageHeight / 2 + this.imageHDR.beamCY) - imageY) / this.imageHDR.pxpmmY;\n      const res = resolutionAt(\n        cx,\n        cy,\n        this.imageHDR.detector_distance,\n        this.imageHDR.wavelength\n      ).toFixed(2);\n\n      this.mouseOverInfoDiv.dom.innerHTML = `X:${imageX} Y:${imageY} <br /> Intensity: ${intensity} <br /> Resolution ${res}`;\n      this.mouseOverInfoDiv.show();\n      this.mouseOverInfoDiv.setPosition(e.clientX, e.clientY);\n    }\n  }\n\n  scale = (s) => {\n    this.d3zoom.scaleTo(this.d3view, s);\n    this.camera.zoom = s;\n    this.camera.updateProjectionMatrix();\n  }\n\n  resetScale = () => {\n    this.scale(this.container.clientHeight / this.imageHeight);\n  }\n\n  relativeScale = (s) => {\n    this.scale(this.camera.zoom + s);\n  }\n\n  animateThree = () => {\n    this.renderer.render(this.scene, this.camera);\n    this.stats.update();\n    window.requestAnimationFrame(this.animateThree);\n  }\n\n  clearThree(obj) {\n    while (obj.children.length > 0) {\n      this.clearThree(obj.children[0]);\n      obj.remove(obj.children[0]);\n    }\n\n    if (obj.geometry) {\n      obj.geometry.dispose();\n    }\n\n    if (obj.material) {\n      obj.material.dispose();\n    }\n\n    if (obj.mesh) {\n      obj.mesh.dispose();\n    }\n\n    if (obj.texture) {\n      obj.texture.dispose();\n    }\n  }\n\n  createUVMapping = (geometry) => {\n    /* eslint no-param-reassign: [\"error\", { \"props\": false }] */\n\n    geometry.computeBoundingBox();\n\n    const { max } = geometry.boundingBox;\n    const { min } = geometry.boundingBox;\n\n    const offset = new THREE.Vector2(0 - min.x, 0 - min.y);\n    const range = new THREE.Vector2(max.x - min.x, max.y - min.y);\n\n    geometry.faceVertexUvs[0] = [];\n    const { faces } = geometry;\n\n    for (let i = 0; i < geometry.faces.length; i += 1) {\n      const v1 = geometry.vertices[faces[i].a];\n      const v2 = geometry.vertices[faces[i].b];\n      const v3 = geometry.vertices[faces[i].c];\n\n      geometry.faceVertexUvs[0].push([\n        new THREE.Vector2((v1.x + offset.x) / range.x, (v1.y + offset.y) / range.y),\n        new THREE.Vector2((v2.x + offset.x) / range.x, (v2.y + offset.y) / range.y),\n        new THREE.Vector2((v3.x + offset.x) / range.x, (v3.y + offset.y) / range.y)\n      ]);\n    }\n\n    geometry.uvsNeedUpdate = true;\n  }\n\n  createGlCricle = (r, xo = 0, yo = 0) => {\n    const dashMaterial = new THREE.LineBasicMaterial({\n      color: 0xffffff,\n      linewidth: 1\n    });\n\n    const circleGeom = new THREE.CircleGeometry(r, 100, 0, 3 * Math.PI);\n    const circle = new THREE.Line(circleGeom, dashMaterial);\n    circleGeom.vertices.shift();\n\n    circle.position.x = this.container.clientWidth / 2 + xo;\n    circle.position.y = this.container.clientHeight / 2 + yo;\n    circle.position.z = -1;\n\n    circle.needsUpdate = true;\n\n    return circle;\n  }\n\n  createDiffractionRings() {\n    const rings = resolutionRings(\n      this.imageHDR.detector_radius,\n      this.imageHDR.detector_distance,\n      this.imageHDR.wavelength\n    );\n\n    const glRings = rings.map(ring => (\n      this.createGlCricle(ring.r * this.imageHDR.pxpmmX,\n        -this.imageHDR.beamCX,\n        -this.imageHDR.beamCY)\n    ));\n\n    glRings.push(this.createGlCricle(5, -this.imageHDR.beamCX, -this.imageHDR.beamCY));\n\n    return glRings;\n  }\n\n  renderImageData = (data, width, height, dtype = 'float32') => {\n    // Clear already existing scene\n    this.data = data;\n    this.imageWidth = width;\n    this.imageHeight = height;\n    this.clearThree(this.scene);\n    this.scene.dispose();\n\n    const rectShape = new THREE.Shape();\n    rectShape.moveTo(0, 0);\n    rectShape.lineTo(0, height);\n    rectShape.lineTo(width, height);\n    rectShape.lineTo(width, 0);\n    rectShape.lineTo(0, 0);\n\n    this.geometry = new THREE.ShapeGeometry(rectShape);\n    this.createUVMapping(this.geometry);\n\n    let threeDtype = THREE.UnsignedByteType;\n    let threeFormat = THREE.RGBAFormat;\n    let { shader } = this;\n\n    if (dtype === 'float32') {\n      threeDtype = THREE.FloatType;\n      threeFormat = THREE.LuminanceFormat;\n      shader = StdShader;\n    } else {\n      shader = RGBShader;\n    }\n\n    this.dataTexture = new THREE.DataTexture(\n      data,\n      width,\n      height,\n      threeFormat,\n      threeDtype,\n      THREE.UVMapping\n    );\n\n    this.dataTexture.flipY = true;\n    this.dataTexture.needsUpdate = true;\n\n    this.dataTexture.wrapS = THREE.ClampToEdgeWrapping;\n    this.dataTexture.wrapT = THREE.ClampToEdgeWrapping;\n    this.dataTexture.magFilter = THREE.NearestFilter;\n    this.dataTexture.minFilter = THREE.LinearFilter;\n\n    this.dataMaterial = new THREE.ShaderMaterial({\n      transparent: true,\n      uniforms: {\n        cmap: { value: this.cmap },\n        cmap_min: { value: this.cmap_min },\n        cmap_max: { value: this.cmap_max },\n        data: { value: this.dataTexture },\n      },\n      vertexShader: shader.vertexShader,\n      fragmentShader: shader.fragmentShader\n    });\n\n    this.dataMaterial.needsUpdate = true;\n\n    this.mesh = new THREE.Mesh(this.geometry, this.dataMaterial);\n    this.mesh.geometry.center();\n    this.scale(this.container.clientHeight / height);\n\n    this.mesh.position.x = this.container.clientWidth / 2;\n    this.mesh.position.y = this.container.clientHeight / 2;\n    this.mesh.needsUpdate = true;\n\n    this.scene.add(this.mesh);\n\n    this.diffraction_rings = this.createDiffractionRings();\n\n    this.diffraction_rings.forEach(ring => (\n      this.scene.add(ring)\n    ));\n\n    if (this.renderRings) {\n      this.showDiffractionRings(true);\n    }\n\n    this.scene.needsUpdate = true;\n  }\n\n  render = (rawDataBuffer, imgHeader, dtype) => {\n    this.setImageHdr(\n      imgHeader.beam_ocx,\n      imgHeader.beam_ocy,\n      imgHeader.pxxpm,\n      imgHeader.pxypm,\n      imgHeader.detector_distance,\n      imgHeader.detector_radius,\n      imgHeader.wavelength,\n      imgHeader.min,\n      imgHeader.max,\n      imgHeader.mean,\n      imgHeader.std,\n    );\n\n    this.renderImageData(\n      rawDataBuffer,\n      imgHeader.img_width,\n      imgHeader.img_height,\n      dtype\n    );\n  }\n}\n","import React from 'react';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport Form from 'react-bootstrap/Form';\nimport Slider from 'rc-slider';\nimport NumericInput from 'react-numeric-input';\nimport 'rc-slider/assets/index.css';\n\nimport {\n  FaRegPlusSquare,\n  FaRegDotCircle,\n  FaRegMinusSquare,\n  FaRegSun\n} from 'react-icons/fa';\n\nimport ImageView from './ImageView';\n\nexport default class ReactImageView extends React.Component {\n  constructor(props) {\n    super(props);\n    this.imageView = new ImageView();\n    this.canvasContainerRef = React.createRef();\n    this.state = {\n      toolboxVisible: false\n    };\n  }\n\n  componentDidMount() {\n    this.imageView.init(this.canvasContainerRef.current);\n  }\n\n  availableColormaps = () => {\n    let cmaps = [];\n\n    if (this.imageView) {\n      cmaps = Object.keys(this.imageView.shader.cmaps);\n    }\n\n    return cmaps;\n  }\n\n  renderToolBox = () => {\n    const { toolboxVisible } = this.state;\n    let tbox = null;\n\n    if (this.imageView) {\n      tbox = (\n        <div className={`toolbox ${toolboxVisible ? 'toolbox-visible' : ''}`}>\n          <ListGroup variant=\"flush\" className={`${toolboxVisible ? 'toolbox-visible' : ''}`}>\n            <ListGroup.Item>\n              <h4>\n                <small className=\"text-muted\">\n                  Info\n                </small>\n              </h4>\n              <Row>\n                <Col xs=\"4\">\n                  Det. distance:\n                </Col>\n                <Col xs=\"2\">\n                  { this.imageView.imageHDR.detector_distance.toFixed(4) }\n                </Col>\n                <Col xs=\"4\">\n                 Wavelength\n                </Col>\n                <Col xs=\"2\">\n                  { this.imageView.imageHDR.wavelength.toFixed(4) }\n                </Col>\n              </Row>\n              <Row>\n                <Col xs=\"4\">\n                  Min:\n                </Col>\n                <Col xs=\"2\">\n                  { this.imageView.imageHDR.min }\n                </Col>\n                <Col xs=\"4\">\n                 Mean:\n                </Col>\n                <Col xs=\"2\">\n                  { this.imageView.imageHDR.mean.toFixed(2) }\n                </Col>\n              </Row>\n              <Row>\n                <Col xs=\"4\">\n                  Max:\n                </Col>\n                <Col xs=\"2\">\n                  { this.imageView.imageHDR.max }\n                </Col>\n                <Col xs=\"4\">\n                 Std:\n                </Col>\n                <Col xs=\"2\">\n                  { this.imageView.imageHDR.std.toFixed(2) }\n                </Col>\n              </Row>\n            </ListGroup.Item>\n            <ListGroup.Item>\n              <h4>\n                <small className=\"text-muted\">\n                  Options\n                </small>\n              </h4>\n              <Form.Group>\n                <Form.Check\n                  checked={this.imageView.renderRings}\n                  type=\"checkbox\"\n                  label=\"Show diffraction rings\"\n                  onChange={(e) => {\n                    this.imageView.showDiffractionRings(e.target.checked);\n                    this.forceUpdate();\n                  }}\n                />\n              </Form.Group>\n            </ListGroup.Item>\n            <ListGroup.Item>\n              <h4>\n                <small className=\"text-muted\">\n                  Colormap\n                </small>\n              </h4>\n              <Form>\n                <Form.Group>\n                  <Form.Control\n                    as=\"select\"\n                    onChange={(e) => {\n                      this.imageView.setColormap(e.target.selectedIndex);\n                    }}\n                  >\n                    {this.availableColormaps().map(cmap => (<option>{cmap}</option>))}\n                  </Form.Control>\n                </Form.Group>\n                <Form.Group>\n                  <Form.Label>\n                    Value range\n                  </Form.Label>\n                  <Slider.Range\n                    min={this.imageView.valueLimitRange[0]}\n                    max={this.imageView.valueLimitRange[1]}\n                    marks={{\n                      [this.imageView.valueLimitRange[0]]: 'min',\n                      [this.imageView.valueLimitRange[1]]: 'max'\n                    }}\n                    step={1}\n                    value={[\n                      this.imageView.cmap_min,\n                      this.imageView.cmap_max]\n                    }\n                    onChange={(range) => {\n                      this.imageView.setValueRange(range[0], range[1]);\n                      this.forceUpdate();\n                    }}\n                  />\n                </Form.Group>\n                <Form.Row>\n                  <Form.Group as={Col} xs=\"3\">\n                    <NumericInput\n                      size={3}\n                      max={this.imageView.imageHDR.max - 1}\n                      min={this.imageView.imageHDR.min}\n                      value={Math.floor(this.imageView.valueLimitRange[0])}\n                      onChange={(v) => {\n                        const value = Math.floor(parseInt(v, 10));\n\n                        if (!Number.isNaN(value)) {\n                          this.imageView.setValueLimitRange(\n                            value,\n                            this.imageView.valueLimitRange[1],\n                          );\n                          this.forceUpdate();\n                        }\n                      }}\n                    />\n                  </Form.Group>\n                  <Col className=\"col-xs-auto text-center\">\n                    {`Range ${Math.floor(this.imageView.cmap_min)} - ${Math.floor(this.imageView.cmap_max)}`}\n                  </Col>\n                  <Form.Group as={Col} xs=\"3\">\n                    <NumericInput\n                      size={3}\n                      max={this.imageView.imageHDR.max}\n                      min={this.imageView.imageHDR.min + 1}\n                      value={Math.floor(this.imageView.valueLimitRange[1])}\n                      onChange={(v) => {\n                        const value = Math.floor(parseInt(v, 10));\n\n                        if (!Number.isNaN(value)) {\n                          this.imageView.setValueLimitRange(\n                            this.imageView.valueLimitRange[0],\n                            value\n                          );\n                          this.forceUpdate();\n                        }\n                      }}\n                    />\n                  </Form.Group>\n                </Form.Row>\n              </Form>\n            </ListGroup.Item>\n          </ListGroup>\n        </div>\n      );\n    }\n\n    return tbox;\n  }\n\n  render() {\n    const { toolboxVisible } = this.state;\n\n    return (\n      <div className=\"imageview\">\n        <div\n          className=\"toolbar\"\n          id=\"imageview-menu\"\n        >\n          <FaRegMinusSquare\n            onClick={() => {\n              this.imageView.relativeScale(-0.1);\n            }}\n          />\n          <FaRegDotCircle\n            onClick={() => {\n              this.imageView.resetScale();\n            }}\n          />\n          <FaRegPlusSquare\n            onClick={() => {\n              this.imageView.relativeScale(0.1);\n            }}\n          />\n          <FaRegSun\n            onClick={() => {\n              this.setState({ toolboxVisible: !toolboxVisible });\n            }}\n          />\n        </div>\n        {this.renderToolBox()}\n        <div\n          id=\"imageview-container\"\n          ref={this.canvasContainerRef}\n          className=\"image\"\n        />\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport SwipeableDrawer from '@material-ui/core/SwipeableDrawer';\nimport List from '@material-ui/core/List';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport Fade from '@material-ui/core/Fade';\n\nimport { withStyles } from '@material-ui/core/styles';\n\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\n\nimport FileBrowser from 'views/file-browser/FileBrowser';\nimport ReactImageView from 'views/imageview/ReactImageView';\n\nimport * as ImageViewActions from 'app/imageview/imageview-actions';\n\nconst drawerWidth = 300;\n\nconst styles = theme => ({\n  root: {\n    display: 'flex'\n  },\n  drawer: {\n    width: drawerWidth\n  },\n  drawerPaper: {\n    width: drawerWidth\n  },\n  appBar: {\n    zIndex: theme.zIndex.drawer + 1,\n    background: '#ffffff'\n  },\n  content: {\n    padding: theme.spacing.unit * 3\n  },\n  optionsForm: {\n    padding: theme.spacing.unit * 2\n  },\n  imageViewContainer: {\n    position: 'absolute',\n    left: '10px',\n    right: '10px',\n    top: '10px',\n    bottom: '10px',\n    overflow: 'hidden'\n  },\n  toolbar: theme.mixins.toolbar,\n  snackBar: {\n    bottom: '2em'\n  },\n  menuButton: {\n    position: 'fixed',\n    zIndex: 1,\n    right: '0.5em',\n    top: '0.5em'\n  },\n  hide: {\n    display: 'none',\n  },\n\n});\n\n\nclass ResponsiveDrawer extends React.Component {\n  componentDidUpdate() {\n    // debugger;\n\n    // if (window.twoDImageView.data) {\n    //   debugger;\n    //   const d = window.twoDImageView.data;\n    //   const x = {};\n    //   // const y = [];\n\n    //   for (let i = 0; i <= d.length; i += 1) {\n    //     if (x[d[i]] !== undefined) {\n    //       x[d[i]] += 1;\n    //     } else {\n    //       x[d[i]] = 0;\n    //     }\n    //   }\n\n    //   debugger;\n\n    //   const trace = {\n    //     x: Object.keys(x),\n    //     y: Object.values(x),\n    //     type: 'histogram',\n    //     histfunc: 'count',\n    //     histnorm: 'density',\n    //     autobinx: false,\n    //     xbins: {\n    //       end: 10000,\n    //       size: 1,\n    //       start: -2\n    //     },\n    //   };\n\n    //   const data = [trace];\n    //   Plotly.newPlot('histogram', data);\n    // }\n  }\n\n  log10 = value => ([Math.log(value[0]) / Math.log(10), Math.log(value[1]) / Math.log(10)])\n\n  pow10 = x => (x ** 10)\n\n  valueLabelFormat = (x) => {\n    const [coefficient, exponent] = this.pow10(x)\n      .toExponential()\n      .split('e')\n      .map(item => Number(item));\n    return `${Math.round(coefficient)}e^${exponent}`;\n  }\n\n  render() {\n    const {\n      classes,\n      images,\n      app,\n      fetchImageRequest,\n      currentImagePath\n    } = this.props;\n\n    const drawer = (\n      <div>\n        <List>\n          <FileBrowser\n            onFileClick={fetchImageRequest}\n            downloadedFiles={images}\n          />\n        </List>\n      </div>\n    );\n\n    return (\n      <div className={classes.root}>\n        <CssBaseline />\n        {/* The implementation can be swapped with js to avoid SEO duplication of links. */}\n        <SwipeableDrawer\n          variant=\"persistent\"\n          anchor=\"left\"\n          className={classes.drawer}\n          classes={{\n            paper: classes.drawerPaper\n          }}\n          open={!app.follow}\n        >\n          {drawer}\n        </SwipeableDrawer>\n        <Snackbar\n          className={classes.snackBar}\n          open={app.follow}\n          onClose={this.handleClose}\n          TransitionComponent={Fade}\n          ContentProps={{\n            'aria-describedby': 'message-id',\n          }}\n          message={(\n            <span id=\"message-id\">\n              Following:\n              {currentImagePath}\n            </span>)}\n        />\n        <main className={classes.content}>\n          <div className={classes.imageViewContainer}>\n            <ReactImageView\n              currentImage={currentImagePath}\n            />\n          </div>\n        </main>\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ imageView, app }) {\n  return {\n    options: imageView.options,\n    currentImagePath: imageView.currentImage,\n    images: imageView.images,\n    app\n  };\n}\n\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators(ImageViewActions, dispatch);\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(\n  withStyles(styles, { withTheme: true })(ResponsiveDrawer)\n);\n","import React, { Component } from 'react';\nimport { Route } from 'react-router-dom';\nimport Drawer from 'views/main/Drawer';\n\nimport 'views/app.css';\n\nclass Main extends Component {\n  render() {\n    return (\n      <div className=\"app\">\n        <div>\n          <Route exact path=\"/\" component={Drawer} />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Main;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\n/* eslint-disable no-param-reassign */\n/* eslint-disable no-console */\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost'\n    // [::1] is the IPv6 localhost address.\n    || window.location.hostname === '[::1]'\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    || window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all '\n                  + 'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404\n        || (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function register(config) {\n  if ('serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service '\n              + 'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import io from 'socket.io-client';\n\nimport { initFileBrowserRequest } from 'app/file-browser/file-browser-actions';\nimport * as ImageViewActions from 'app/imageview/imageview-actions';\nimport * as AppActions from 'app/app-actions';\nimport DownloadWorker from 'app/imageview/full-data-download.worker';\nimport DataWorker from 'app/imageview/preview-data-download.worker';\nimport imageBuffer from 'app/utils/buffer';\nimport { getImageView } from 'views/imageview/ImageView';\n\nexport default function initApp(store) {\n  const socket = io.connect(`http://${document.domain}:${window.location.port}`, { path: '/api/socket.io/' });\n\n  store.dispatch(initFileBrowserRequest());\n\n  socket.on('connect', () => (console.log('connect')));\n\n  socket.on('show-image', (data) => {\n    store.dispatch(ImageViewActions.fetchImageRequest(data.path));\n  });\n\n  socket.on('set-follow', (data) => {\n    store.dispatch(AppActions.setFollow(\n      data.follow,\n      data.wavelength,\n      data.detector_distance,\n      data.detector_radius\n    ));\n  });\n\n  socket.on('disconnect', () => (console.log('disconnect')));\n\n  window.fullDataDownloadWorker = new DownloadWorker();\n  window.previewDataDownloadWorker = new DataWorker();\n\n  window.fullDataDownloadWorker.onmessage = function (e) {\n    const { follow } = store.getState().app;\n    const { downloadFull } = store.getState().imageView.options;\n\n    if (!follow && downloadFull) {\n      const { hdr } = imageBuffer.get(e.data.path);\n      const rawData = e.data.data;\n\n      imageBuffer.add(e.data.path, 'raw', rawData);\n      getImageView('default').render(rawData, hdr, 'float32');\n      getImageView('default').setValueRange(hdr.min, hdr.mean * 10);\n      getImageView('default').setValueLimitRange(hdr.min, hdr.std * 3);\n      store.dispatch(ImageViewActions.setAndAddImage(e.data.path, hdr));\n    }\n  };\n\n  window.previewDataDownloadWorker.onmessage = function (e) {\n    const { follow } = store.getState().app;\n    const { downloadFull } = store.getState().imageView.options;\n\n    if (follow || !downloadFull) {\n      const { hdr } = imageBuffer.get(e.data.path);\n      const rgbData = e.data.data;\n\n      imageBuffer.add(e.data.path, 'preview', rgbData);\n      getImageView('default').render(rgbData, hdr, 'int32');\n      store.dispatch(ImageViewActions.setAndAddImage(e.data.path, hdr));\n    }\n  };\n}\n","import React from 'react';\nimport { render } from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { ConnectedRouter } from 'connected-react-router';\n\nimport store, { history } from 'app/redux-store';\nimport Main from 'views/main/Main';\nimport * as serviceWorker from 'serviceWorker';\nimport initApp from 'app/utils/utils';\nimport 'index.scss';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\ninitApp(store);\n\nconst target = document.querySelector('#root');\n\nrender(\n  <Provider store={store}>\n    <ConnectedRouter history={history}>\n      <Main />\n    </ConnectedRouter>\n  </Provider>,\n  target\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}