(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{210:function(e,t,n){e.exports=function(){return new Worker(n.p+"2bb43da623c9e2f18afd.worker.js")}},213:function(e,t,n){e.exports=n(503)},236:function(e,t){},499:function(e,t,n){},501:function(e,t,n){},503:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"SET_CONTENT",function(){return S}),n.d(a,"SET_LOADING",function(){return C}),n.d(a,"SET_SELECTED_FILE",function(){return k}),n.d(a,"INIT",function(){return T}),n.d(a,"SET_RANGE",function(){return _}),n.d(a,"default",function(){return A}),n.d(a,"listDirSuccess",function(){return F}),n.d(a,"initSuccess",function(){return L}),n.d(a,"setLoading",function(){return P}),n.d(a,"selectFile",function(){return z}),n.d(a,"setRange",function(){return W}),n.d(a,"listDirRequest",function(){return G}),n.d(a,"initFileBrowserRequest",function(){return q});var i={};n.r(i),n.d(i,"INIT",function(){return U}),n.d(i,"ADD_IMAGE",function(){return B}),n.d(i,"SET_CURRENT_IMAGE",function(){return X}),n.d(i,"SET_AND_ADD_IMAGE",function(){return H}),n.d(i,"SET_OPTION",function(){return J}),n.d(i,"SET_RAW_DATA",function(){return Q}),n.d(i,"default",function(){return K}),n.d(i,"addImage",function(){return Z}),n.d(i,"setAndAddImage",function(){return ee}),n.d(i,"setOption",function(){return te}),n.d(i,"setCurrentImage",function(){return ne}),n.d(i,"setRawData",function(){return ae}),n.d(i,"fetchImageSuccess",function(){return ie}),n.d(i,"fetchImageRequest",function(){return re});var r=n(0),o=n.n(r),c=n(191),s=n.n(c),u=n(34),l=n(25),h=n(60),d=n(18),p=n(133),f=n(193),g=n.n(f),m=n(194),v=n(195),b=n.n(v),w=n(9),O="counter/INCREMENT_REQUESTED",E="counter/INCREMENT",y="counter/DECREMENT_REQUESTED",I="counter/DECREMENT",j={count:0,isIncrementing:!1,isDecrementing:!1},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j;switch((arguments.length>1?arguments[1]:void 0).type){case O:return Object(w.a)({},e,{isIncrementing:!0});case E:return Object(w.a)({},e,{count:e.count+1,isIncrementing:!e.isIncrementing});case y:return Object(w.a)({},e,{isDecrementing:!0});case I:return Object(w.a)({},e,{count:e.count-1,isDecrementing:!e.isDecrementing});default:return e}};var x=n(51),D=n.n(x),S="file-browser/SET_CONTENT",C="file-browser/SET_LOADING",k="file-browser/SET_SELECTED_FILE",T="file-browser/INIT",_="file-browser/SET_RANGE",M="/api/file-browser",N={files:[],selectedFile:"",loading:!1,pageSize:10,currentRange:[0,14]},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:return Object(w.a)({},e,{files:t.files});case C:return Object(w.a)({},e,{loading:t.loading});case k:return Object(w.a)({},e,{selectedFile:t.path});case _:var n=[];return n="inc"===t.op?e.currentRange.map(function(t){return t+e.pageSize}):e.currentRange.map(function(t){return t-e.pageSize}),Object(w.a)({},e,{currentRange:n});case T:return Object(w.a)({},e,{files:t.files});default:return e}};function F(e){return function(t){t({type:S,files:e})}}function L(e){return function(t){t({type:T,files:e})}}function P(e){return function(t){t({type:C,loading:e})}}function z(e){return function(t){t({type:k,path:e})}}function W(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"inc";return function(t){t({type:_,op:e})}}function G(e){return function(t){t(P(!0)),D.a.post("".concat(M,"/list-dir"),{path:e}).then(function(e){t(F(e.data)),t(P(!1))}).catch(function(e){throw e}).catch(function(){t(P(!1))})}}function q(){return function(e){e(P(!0)),D.a.post("".concat(M,"/init")).then(function(t){e(L(t.data))}).catch(function(e){throw e}).then(function(){e(P(!1))})}}var V=n(30),U="imageview/INIT",B="imageview/ADD_IMAGE",X="imageview/SET_CURRENT_IMAGE",H="imageview/SET_AND_ADD_IMAGE",J="imageview/SET_OPTION",Q="imageview/SET_RAW_DATA",Y="/api/imageview",$={images:{},currentImage:"",imageScale:1,options:{showResolution:!0,autoScale:!0,aggDownload:!0}},K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:return Object(w.a)({},$);case H:return Object(w.a)({},e,{images:Object(w.a)({},e.images,Object(V.a)({},t.path,{data:t.data,hdr:t.hdr,raw:null})),currentImage:t.path});case B:return Object(w.a)({},e,{images:Object(w.a)({},e.images,Object(V.a)({},t.path,{data:t.data,hdr:t.hdr,raw:null}))});case Q:return Object(w.a)({},e,{images:Object(w.a)({},e.images,Object(V.a)({},t.path,Object(w.a)({},e.images[t.path],{raw:t.data})))});case X:return Object(w.a)({},e,{currentImage:t.path});case J:return Object(w.a)({},e,{options:Object(w.a)({},e.options,Object(V.a)({},t.option,t.value))});default:return e}};function Z(e){return function(t){t({type:B,path:e.path,data:e.data,width:e.width,height:e.height})}}function ee(e){return function(t){t({type:H,path:e.path,data:e.data,hdr:e.hdr})}}function te(e,t){return function(n){n({type:J,option:e,value:t})}}function ne(e){return function(t){t({type:X,path:e})}}function ae(e,t){return function(n){n({type:Q,path:e,data:t})}}function ie(e){return function(t){t(ee(e))}}function re(e){return function(t,n){var a=n().imageView.images;e in a?t(ne(e)):D.a.post("".concat(Y,"/preload"),{path:e}).then(function(n){var a=n.data;D.a.post("/api/imageview/image",{path:e},{responseType:"blob"}).then(function(n){var i=window.URL.createObjectURL(n.data);t(ie({path:e,data:i,hdr:a})),window.imgWorker.postMessage({path:e})})}).catch(function(e){throw e})}}var oe,ce=b()(),se=[m.a,Object(p.a)(ce),g.a],ue=d.d.apply(void 0,[d.a.apply(void 0,se)].concat([])),le=Object(d.e)((oe=ce,Object(d.c)({router:Object(h.b)(oe),counter:R,fileBrowser:A,imageView:K})),{},ue),he=n(38),de=n(39),pe=n(41),fe=n(40),ge=n(42),me=n(505),ve=n(208),be=n.n(ve),we=n(207),Oe=n.n(we),Ee=n(209),ye=n.n(Ee),Ie=n(85),je=n.n(Ie),Re=n(205),xe=n.n(Re),De=n(206),Se=n.n(De),Ce=n(88),ke=n.n(Ce),Te=n(89),_e=n.n(Te),Me=n(45),Ne=n(10),Ae=n(203),Fe=n.n(Ae),Le=n(197),Pe=n.n(Le),ze=n(198),We=n.n(ze),Ge=n(201),qe=n.n(Ge),Ve=n(112),Ue=n.n(Ve),Be=n(200),Xe=n.n(Be),He=n(199),Je=n.n(He),Qe=n(202),Ye=n.n(Qe),$e=n(204),Ke=n.n($e),Ze=n(270);var et=function(e){function t(e){var n;return Object(he.a)(this,t),(n=Object(pe.a)(this,Object(fe.a)(t).call(this,e))).state={filterTerm:""},n.listItemOnClick=n.listItemOnClick.bind(Object(Ne.a)(Object(Ne.a)(n))),n.filterInputOnChange=n.filterInputOnChange.bind(Object(Ne.a)(Object(Ne.a)(n))),n}return Object(ge.a)(t,e),Object(de.a)(t,[{key:"listItemOnClick",value:function(e){var t=this.props,n=t.listDirRequest,a=t.onFileClick,i=t.selectFile;e.isLeaf?(i(e.fpath),a(e.fpath)):n(e.fpath)}},{key:"showFiles",value:function(){var e=this,t=this.props,n=t.files,a=t.selectedFile,i=t.currentRange,r=t.downloadedFiles,c=t.classes,s=this.state.filterTerm;return n.filter(function(e){return function(e,t){var n=!0;return t&&(n=Ze.isMatch(e,"".concat(t,"*"))),n}(e.text,s)}).slice(i[0],i[1]).map(function(t){return o.a.createElement(Pe.a,{button:!0,key:t.text,selected:t.fpath===a,onClick:function(){return e.listItemOnClick(t)}},o.a.createElement(We.a,{className:t.fpath in r?c.downloadedItem:c.item},t.isLeaf?o.a.createElement(Je.a,null):o.a.createElement(Xe.a,null)),o.a.createElement(qe.a,{primary:t.text}))})}},{key:"busyIndicator",value:function(){var e=this.props.classes;return o.a.createElement(Ye.a,{disableShrink:!0,className:e.progress})}},{key:"filterInputOnChange",value:function(e){this.setState({filterTerm:e.target.value})}},{key:"fileNavigation",value:function(){var e=this.props,t=e.files,n=e.pageSize,a=e.currentRange,i=e.setRange,r=e.classes,c=!0,s=!0;return t.length>n&&0===a[0]?s=!1:t.length>n&&a[1]>t.length?c=!1:t.length<n&&(s=!1,c=!1),o.a.createElement("div",{className:r.fileNavContainer},o.a.createElement(Ue.a,{size:"small",disabled:!s,className:r.margin,onClick:function(){return i("dec")}},"PREV"),o.a.createElement(Ue.a,{size:"small",disabled:!c,className:r.margin,onClick:function(){return i("inc")}},"NEXT"))}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.loading;return o.a.createElement("div",null,o.a.createElement(je.a,null,o.a.createElement(Fe.a,{component:"div",style:{background:"#FFF"}},o.a.createElement("div",null,o.a.createElement(Ke.a,{placeholder:"Search",className:t.input,inputProps:{"aria-label":"Filter"},onChange:this.filterInputOnChange}))),o.a.createElement("div",{className:t.scrollContainer},n?this.busyIndicator():this.showFiles())),this.fileNavigation())}}]),t}(o.a.Component);var tt=Object(l.c)(function(e){var t=e.fileBrowser;return{files:t.files,loading:t.loading,selectedFile:t.selectedFile,currentRange:t.currentRange,pageSize:t.pageSize}},function(e){return Object(d.b)(a,e)})(Object(Me.withStyles)(function(e){return{scrollContainer:{overflow:"auto"},input:{marginLeft:"1px",marginBottom:2*e.spacing.unit},fileNavContainer:{textAlign:"center"},progress:{marginLeft:"auto",marginRight:"auto",display:"block",top:"50%",bottom:"50%"},downloadedItem:{color:"#307fd6"},item:{}}},{withTheme:!0})(et)),nt=n(211),at=n(44);function it(e){var t=new at.c,n=[];return t.lineStyle(1,16711935,.2),t.endFill(),n.push(t),function(e,t,n){for(var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.03,i=[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01;r<=e;r+=a){var o=r*Math.PI,c=n/(2*Math.sin(.5*Math.atan(o/t)));i.push({r:r,res:c})}return i}(e.detector_radius,e.detector_distance,e.wavelength).forEach(function(a){var i=a.r*e.pxypm;t.drawCircle(e.beam_ocx,e.beam_ocy,i);var r=new at.e("".concat(a.res.toFixed(2).toString()," A"),{fontFamily:"Arial",fontSize:45,fill:16715792,align:"center"});r.x=e.beam_ocx+i+20,r.y=e.beam_ocy,r.anchor.set(.5),r.alpha=.7,n.push(r)}),n}var rt=function(e){function t(e){var n;return Object(he.a)(this,t),(n=Object(pe.a)(this,Object(fe.a)(t).call(this,e))).renderImageData=n.renderImageData.bind(Object(Ne.a)(Object(Ne.a)(n))),n.renderResolutionRings=n.renderResolutionRings.bind(Object(Ne.a)(Object(Ne.a)(n))),n.onMouseWheel=n.onMouseWheel.bind(Object(Ne.a)(Object(Ne.a)(n))),n.onMouseOver=n.onMouseOver.bind(Object(Ne.a)(Object(Ne.a)(n))),n.onMouseOut=n.onMouseOut.bind(Object(Ne.a)(Object(Ne.a)(n))),n.onMouseMove=n.onMouseMove.bind(Object(Ne.a)(Object(Ne.a)(n))),n.canvasContainerRef=o.a.createRef(),n.infoDisplayDivRef=o.a.createRef(),n.pixiapp=new at.a({transparent:!0,roundPixels:!0}),n.currentImg=null,n.container=null,n.scale=1,n.mouseOverEvent=null,n}return Object(ge.a)(t,e),Object(de.a)(t,[{key:"componentDidMount",value:function(){var e=this.canvasContainerRef.current.clientWidth,t=this.canvasContainerRef.current.clientHeight;this.pixiapp.view.addEventListener("mousewheel",this.onMouseWheel,!1),this.canvasContainerRef.current.appendChild(this.pixiapp.view),this.pixiapp.renderer.autoResize=!0,this.pixiapp.renderer.resize(e,t)}},{key:"componentDidUpdate",value:function(e){var t=this,n=this.props,a=n.currentImage,i=n.showResolution,r=e.currentImage,o=e.showResolution;a!==r&&window.requestAnimationFrame(function(){return t.renderImageData()}),o!==i&&window.requestAnimationFrame(function(){return t.renderResolutionRings()})}},{key:"componentWillUnmount",value:function(){this.pixiapp.view.removeEventListener(this.onMouseWheel)}},{key:"onMouseWheel",value:function(e){this.mouseOverEvent&&(this.scale+=.001*e.wheelDelta,this.currentImg.scale.x=this.scale,this.currentImg.scale.y=this.scale,this.container.scale.x=this.scale,this.container.scale.y=this.scale)}},{key:"onMouseOver",value:function(e){this.mouseOverEvent=e}},{key:"onMouseOut",value:function(){this.mouseOverEvent=null,this.infoDisplayDivRef.current.style.display="none"}},{key:"onDragStart",value:function(e){return this.dragging=!0,this.dragStartPos=e.data.getLocalPosition(this.parent),this.dragStartOx=this.dragStartPos.x-this.x,this.dragStartOy=this.dragStartPos.y-this.y,e}},{key:"onDragEnd",value:function(){this.alpha=1,this.dragging=!1,this.data=null}},{key:"onMouseMove",value:function(e){var t=this.props,n=t.images[t.currentImage];if(this.currentImg.dragging){var a=e.data.getLocalPosition(this.currentImg.parent);this.currentImg.x=a.x-this.currentImg.dragStartOx,this.currentImg.y=a.y-this.currentImg.dragStartOy,this.container.x=a.x-this.currentImg.dragStartOx,this.container.y=a.y-this.currentImg.dragStartOy}if(this.mouseOverEvent){var i=n.hdr.braggy_hdr,r=e.data.getLocalPosition(this.currentImg),o=Math.floor(this.currentImg.width/this.currentImg.scale.x/2+r.x),c=Math.floor(this.currentImg.height/this.currentImg.scale.y/2+r.y),s=this.currentImg.width/this.currentImg.scale.x,u=n.raw?n.raw[Math.floor(c*s+o)]:"?",l=function(e,t,n,a){var i=Math.sqrt(e*e+t*t)*Math.PI;return a/(2*Math.sin(.5*Math.atan(i/n)))}((i.img_width/2+i.beam_ocx-o)/i.pxxpm,(i.img_height/2+i.beam_ocy-c)/i.pxypm,i.detector_distance,i.wavelength).toFixed(2);this.infoDisplayDivRef.current.style.top="".concat(e.data.originalEvent.offsetY+15,"px"),this.infoDisplayDivRef.current.style.left="".concat(e.data.originalEvent.offsetX+15,"px"),this.infoDisplayDivRef.current.style.display="block",this.infoDisplayDivRef.current.innerHTML="X:".concat(o," Y:").concat(c," <br /> Intensity: ").concat(u," <br /> Resolution ").concat(l)}}},{key:"imgLoaded",value:function(e,t){var n=t,a=this.props.autoScale,i=this.pixiapp.screen.height/t.height;a&&(n.scale.x=i,n.scale.y=i)}},{key:"renderImageData",value:function(){var e=this,t=this.props,n=t.images[t.currentImage],a=this.pixiapp;a.stage.removeChildren();var i=function(e){var t=new at.d.from(e);return t.interactive=!0,t.anchor.set(.5),t}(n.data);this.currentImg=i,i.texture.baseTexture.on("loaded",function(t){return e.imgLoaded(t,i)}),i.x=a.screen.width/2,i.y=a.screen.height/2,i.zIndex=1,i.on("pointerover",this.onMouseOver),i.on("pointerout",this.onMouseOut),i.on("pointerdown",this.onDragStart),i.on("pointerup",this.onDragEnd),i.on("pointerupoutside",this.onDragEnd),i.on("pointermove",this.onMouseMove),a.stage.addChild(i),this.renderResolutionRings()}},{key:"renderResolutionRings",value:function(){var e=this.props,t=e.images,n=e.currentImage,a=e.showResolution,i=t[n].hdr.braggy_hdr,r=this.pixiapp;if(this.container&&r.stage.removeChild(this.container),this.container=new at.b,this.container.x=this.currentImg.x,this.container.y=this.currentImg.y,this.container.scale.x=this.scale,this.container.scale.y=this.scale,this.container.zIndex=100,void 0!==i.beam_ocx&&a){var o,c=function(e){var t=new at.c;return t.lineStyle(1,16711935,.2),t.drawCircle(e.beam_ocx,e.beam_ocy,3),t.endFill(),t}(i),s=it(i);this.container.addChild(c),(o=this.container).addChild.apply(o,Object(nt.a)(s))}r.stage.addChild(this.container),r.stage.sortChildren()}},{key:"render",value:function(){var e=this.props.classes;return o.a.createElement("div",null,o.a.createElement("div",{id:"imageview-container",ref:this.canvasContainerRef,className:e.imageViewContainer},o.a.createElement("div",{ref:this.infoDisplayDivRef,className:e.infoDisplay})))}}]),t}(o.a.Component);var ot=Object(l.c)(function(e){var t=e.imageView;return{images:t.images,currentImage:t.currentImage,autoScale:t.options.autoScale,showResolution:t.options.showResolution}},function(e){return Object(d.b)({},e)})(Object(Me.withStyles)(function(e){return{imageViewContainer:{position:"absolute",height:"100%",width:"100%"},infoDisplay:{position:"absolute",background:"rgba(0, 0, 0, 0.6)",padding:e.spacing.unit,borderRadius:"4px",color:"rgba(255, 255, 255, 1)",display:"none"}}},{withTheme:!0})(rt)),ct=function(e){function t(){return Object(he.a)(this,t),Object(pe.a)(this,Object(fe.a)(t).apply(this,arguments))}return Object(ge.a)(t,e),Object(de.a)(t,[{key:"toggleDrawer",value:function(e,t){var n=this;return function(){return n.setState(Object(V.a)({},e,t))}}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.fetchImageRequest,a=e.autoScale,i=e.progDownload,r=e.showResolution,c=e.setOption,s=e.images,u=o.a.createElement("div",null,o.a.createElement("div",{className:t.optionsForm},o.a.createElement(xe.a,{component:"legend"},"Options"),o.a.createElement(Se.a,null,o.a.createElement(ke.a,{control:o.a.createElement(_e.a,{color:"primary"}),label:"Auto scale",checked:a,onChange:function(e){c("autoScale",e.target.checked)}}),o.a.createElement(ke.a,{control:o.a.createElement(_e.a,{color:"primary"}),label:"Progressive download",checked:i,onChange:function(e){c("progDownload",e.target.checked)}}),o.a.createElement(ke.a,{control:o.a.createElement(_e.a,{color:"primary"}),label:"Show resolution",checked:r,onChange:function(e){c("showResolution",e.target.checked)}}))),o.a.createElement(Oe.a,null),o.a.createElement(je.a,null,o.a.createElement(tt,{onFileClick:n,downloadedFiles:s})));return o.a.createElement("div",{className:t.root},o.a.createElement(be.a,null),o.a.createElement(ye.a,{className:t.drawer,variant:"permanent",classes:{paper:t.drawerPaper},open:!0},u),o.a.createElement("main",{className:t.content},o.a.createElement("div",{className:t.imageViewContainer},o.a.createElement(ot,null))))}}]),t}(o.a.Component);var st=Object(l.c)(function(e){var t=e.imageView;return{compress:t.options.compress,autoScale:t.options.autoScale,progDownload:t.options.progDownload,showResolution:t.options.showResolution,images:t.images}},function(e){return Object(d.b)(i,e)})(Object(Me.withStyles)(function(e){return{root:{display:"flex"},drawer:{width:240},drawerPaper:{width:240},appBar:{zIndex:e.zIndex.drawer+1,background:"#ffffff"},menuButton:Object(V.a)({marginRight:20},e.breakpoints.up("sm"),{display:"none"}),content:{padding:3*e.spacing.unit},optionsForm:{padding:2*e.spacing.unit},imageViewContainer:{position:"absolute",left:"".concat(250,"px"),right:"10px",top:"10px",bottom:"10px",overflow:"hidden"},toolbar:e.mixins.toolbar}},{withTheme:!0})(ct)),ut=(n(499),function(e){function t(){return Object(he.a)(this,t),Object(pe.a)(this,Object(fe.a)(t).apply(this,arguments))}return Object(ge.a)(t,e),Object(de.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"app"},o.a.createElement("div",null,o.a.createElement(me.a,{exact:!0,path:"/",component:st})))}}]),t}(r.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var lt=n(210),ht=n.n(lt),dt=(n(501),s.a.connect("http://".concat(document.domain,":").concat(window.location.port),{path:"/api/socket.io/"}));le.dispatch(q()),dt.on("connect",function(){return console.log("connect")}),dt.on("show-image",function(e){le.dispatch(re(e.path))}),dt.on("disconnect",function(){return console.log("disconnect")});var pt=new ht.a;window.imgWorker=pt,pt.onmessage=function(e){le.dispatch(ae(e.data.path,e.data.data))};var ft=document.querySelector("#root");Object(u.render)(o.a.createElement(l.a,{store:le},o.a.createElement(h.a,{history:ce},o.a.createElement(ut,null))),ft),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[213,2,1]]]);
//# sourceMappingURL=main.153913a1.chunk.js.map