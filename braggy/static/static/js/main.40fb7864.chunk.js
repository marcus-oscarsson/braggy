(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{238:function(e,t,a){e.exports=function(){return new Worker(a.p+"ae99941c269e3174f6f0.worker.js")}},239:function(e,t,a){e.exports=function(){return new Worker(a.p+"30c8cb5688584303b15f.worker.js")}},254:function(e,t,a){e.exports=a(488)},458:function(e,t,a){},481:function(e,t){},484:function(e,t,a){},488:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"setContent",function(){return D}),a.d(n,"setLoading",function(){return C}),a.d(n,"setSelectedFile",function(){return V}),a.d(n,"default",function(){return k}),a.d(n,"listDirRequest",function(){return I}),a.d(n,"initFileBrowserRequest",function(){return M});var i={};a.r(i),a.d(i,"init",function(){return L}),a.d(i,"setAndAddImage",function(){return z}),a.d(i,"addImage",function(){return P}),a.d(i,"setCurrentImage",function(){return W}),a.d(i,"setOption",function(){return A}),a.d(i,"ImageViewReducer",function(){return B}),a.d(i,"default",function(){return X}),a.d(i,"fetchImageRequest",function(){return G});var r,o=a(0),c=a.n(o),l=a(8),s=a(58),m=a(100),u=a(41),d=a(168),v=a(223),f=a.n(v),g=a(224),h=a(225),p=a.n(h),w=a(24),b=a(27),x=a(532),E=a(533),y=a(102),O=a.n(y),R="/api/file-browser",j=Object(x.a)({SET_CONTENT:function(e){return{files:e}},SET_LOADING:function(e){return{loading:e}},SET_SELECTED_FILE:function(e){return{path:e}},SET_RANGE:function(){return{op:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"inc"}}},{prefix:"filebrowser"}),D=j.setContent,C=j.setLoading,V=j.setSelectedFile,k=Object(E.a)((r={},Object(w.a)(r,D,function(e,t){var a=t.payload.files;return Object(b.a)({},e,{files:a})}),Object(w.a)(r,C,function(e,t){var a=t.payload.loading;return Object(b.a)({},e,{loading:a})}),Object(w.a)(r,V,function(e,t){var a=t.payload.path;return Object(b.a)({},e,{selectedFile:a})}),r),{files:[],selectedFile:"",loading:!1,pageSize:10,currentRange:[0,14]});function I(e){return function(t){t(C(!0)),O.a.post("".concat(R,"/list-dir"),{path:e}).then(function(e){t(D(e.data.items)),t(C(!1))}).catch(function(e){throw e}).catch(function(){t(C(!1))})}}function M(){return function(e){e(C(!0)),O.a.get("".concat(R,"/init")).then(function(t){e(D(t.data.items))}).catch(function(e){throw e}).then(function(){e(C(!1))})}}var _,T=a(37),H=a(40),S=new(function(){function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;Object(T.a)(this,e),this.add=function(e,a,n){if(t.keys.length<t.size){var i=e in t.buffer?t.buffer[e]:{};i[a]=n,t.buffer[e]=i,e in t.buffer||t.keys.push(e)}else null!==t.onOverflow&&t.onOverflow(e,n)},this.del=function(e){t.keys=t.keys.filter(function(t){return t!==e}),delete t.buffer[e]},this.get=function(e){var a=t.buffer[e];return void 0===a&&null!==t.onMiss&&t.onMiss(e),a},this.pop=function(){if(Object.keys(t.buffer).length===t.size){var e=t.keys[0];t.del(e)}},this.buffer={},this.keys=[],this.size=a,this.onOverflow=null,this.onMiss=null}return Object(H.a)(e,[{key:"has",value:function(e){return e in this.buffer}}]),e}()),N="/api/imageview",F={images:{},currentImage:"",imageScale:1,options:{showResolution:!0,autoScale:!0,aggDownload:!0,downloadFull:!0,showFullData:!1,valueRange:[-2,10],valueRangeLimit:[-2,10,5],availableCmaps:{viridis:0,plasma:1,magma:2,inferno:3,temperature:4,grey:5,deadpixels:6},currentCmap:"viridis"}},U=Object(x.a)({INIT:function(){return Object(b.a)({},F)},SET_AND_ADD_IMAGE:function(e,t){return{path:e,hdr:t}},ADD_IMAGE:function(e,t){return{path:e,hdr:t}},SET_CURRENT_IMAGE:function(e){return{path:e}},SET_OPTION:function(e,t){return{key:e,value:t}}},{prefix:"imageview"}),L=U.init,z=U.setAndAddImage,P=U.addImage,W=U.setCurrentImage,A=U.setOption,B=(_={},Object(w.a)(_,L,function(){return Object(b.a)({},F)}),Object(w.a)(_,z,function(e,t){var a=t.payload,n=a.path,i=a.hdr;return Object(b.a)({},e,{images:Object(b.a)({},e.images,Object(w.a)({},n,{hdr:i})),currentImage:n})}),Object(w.a)(_,P,function(e,t){var a=t.payload,n=a.path,i=a.hdr;return Object(b.a)({},e,{images:Object(b.a)({},e.images,Object(w.a)({},n,{hdr:i}))})}),Object(w.a)(_,W,function(e,t){var a=t.payload.path;return Object(b.a)({},e,{currentImage:a})}),Object(w.a)(_,A,function(e,t){var a=t.payload,n=a.key,i=a.value;return Object(b.a)({},e,{options:Object(b.a)({},e.options,Object(w.a)({},n,i))})}),_),X=Object(E.a)(B,F);function G(e){return function(t,a){var n=a().app.follow,i=a().imageView.options.downloadFull;O.a.post("".concat(N,"/preload"),{path:e}).then(function(t){var a=t.data;S.add(e,"hdr",a.braggy_hdr),window.previewDataDownloadWorker.postMessage({path:e,hdr:a}),!n&&i&&window.fullDataDownloadWorker.postMessage({path:e})}).catch(function(e){throw e})}}var Y="app/SET_FOLLOW",q={follow:!1,wavelength:null,detector_distance:null,detector_radius:null},J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"app/INIT":return Object(b.a)({},q);case Y:return Object(b.a)({},e,{follow:t.follow,detectorDistance:t.detectorDistance,wavelength:t.wavelength,detectorRadious:t.detectorRadius});default:return e}};var Z,$=p()(),K=[g.a,Object(d.a)($),f.a],Q=u.d.apply(void 0,[u.a.apply(void 0,K)].concat([])),ee=Object(u.e)((Z=$,Object(u.c)({router:Object(m.b)(Z),app:J,fileBrowser:k,imageView:X})),{},Q),te=a(69),ae=a(67),ne=a(70),ie=a(538),re=a(241),oe=a(536),ce=a(531),le=a(526),se=a(535),me=a(529),ue=a(2),de=a(76),ve=a(527),fe=a(518),ge=a(521),he=a(522),pe=a(525),we=a(229),be=a.n(we),xe=a(228),Ee=a.n(xe),ye=a(524),Oe=a(534),Re=a(288);var je=function(e){function t(e){var a;return Object(T.a)(this,t),(a=Object(te.a)(this,Object(ae.a)(t).call(this,e))).state={filterTerm:""},a.listItemOnClick=a.listItemOnClick.bind(Object(de.a)(Object(de.a)(a))),a.filterInputOnChange=a.filterInputOnChange.bind(Object(de.a)(Object(de.a)(a))),a}return Object(ne.a)(t,e),Object(H.a)(t,[{key:"listItemOnClick",value:function(e){var t=this.props,a=t.listDirRequest,n=t.onFileClick,i=t.setSelectedFile;e.isLeaf?(i(e.fpath),n(e.fpath)):a(e.fpath)}},{key:"showFiles",value:function(){var e=this,t=this.props,a=t.files,n=t.selectedFile,i=t.currentRange,r=t.downloadedFiles,o=t.classes,l=this.state.filterTerm;return a.filter(function(e){return function(e,t){var a=!0;return t&&(a=Re.isMatch(e,"".concat(t,"*"))),a}(e.text,l)}).slice(i[0],i[1]).map(function(t){return c.a.createElement(fe.a,{button:!0,key:t.text,selected:t.fpath===n,onClick:function(){return e.listItemOnClick(t)}},c.a.createElement(ge.a,{className:t.fpath in r?o.downloadedItem:o.item},t.isLeaf?c.a.createElement(Ee.a,null):c.a.createElement(be.a,null)),c.a.createElement(he.a,{primary:t.text}))})}},{key:"busyIndicator",value:function(){var e=this.props.classes;return c.a.createElement(ye.a,{disableShrink:!0,className:e.progress})}},{key:"filterInputOnChange",value:function(e){this.setState({filterTerm:e.target.value})}},{key:"fileNavigation",value:function(){var e=this.props,t=e.files,a=e.pageSize,n=e.currentRange,i=e.setRange,r=e.classes,o=!0,l=!0;return t.length>a&&0===n[0]?l=!1:t.length>a&&n[1]>t.length?o=!1:t.length<a&&(l=!1,o=!1),c.a.createElement("div",{className:r.fileNavContainer},c.a.createElement(pe.a,{size:"small",disabled:!l,className:r.margin,onClick:function(){return i("dec")}},"PREV"),c.a.createElement(pe.a,{size:"small",disabled:!o,className:r.margin,onClick:function(){return i("inc")}},"NEXT"))}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.loading;return c.a.createElement("div",null,c.a.createElement(le.a,null,c.a.createElement(ve.a,{component:"div",style:{background:"#FFF"}},c.a.createElement("div",null,c.a.createElement(Oe.a,{placeholder:"Search",className:t.input,inputProps:{"aria-label":"Filter"},onChange:this.filterInputOnChange}))),c.a.createElement("div",{className:t.scrollContainer},a?this.busyIndicator():this.showFiles())),this.fileNavigation())}}]),t}(c.a.Component);var De=Object(s.c)(function(e){var t=e.fileBrowser;return{files:t.files,loading:t.loading,selectedFile:t.selectedFile,currentRange:t.currentRange,pageSize:t.pageSize}},function(e){return Object(u.b)(n,e)})(Object(ue.a)(function(e){return{scrollContainer:{overflow:"auto"},input:{marginLeft:"1px",marginBottom:2*e.spacing.unit},fileNavContainer:{textAlign:"center"},progress:{marginLeft:"auto",marginRight:"auto",display:"block",top:"50%",bottom:"50%"},downloadedItem:{color:"#307fd6"},item:{}}},{withTheme:!0})(je)),Ce=a(128),Ve=a(25),ke=a(103),Ie=a(47),Me=a(240),_e=a(158),Te=a.n(_e),He=(a(452),a(104)),Se=a(18),Ne=a(233),Fe=a.n(Ne),Ue=a(91),Le={};function ze(e){return Le[e]}var Pe={cmaps:{viridis:0,plasma:1,magma:2,inferno:3,temperature:4,grey:5,greywithred:6},uniforms:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D data;","varying vec2 vUv;","uniform float cmap_min;","uniform float cmap_max;","uniform int cmap;","float normValue(float val) {","float normValue = clamp((val - cmap_min)/(cmap_max - cmap_min), 0.0, 1.0);","return normValue;","}","vec3 viridis(float t) {","const vec3 c0 = vec3(0.2777273272234177, 0.005407344544966578, 0.3340998053353061);","const vec3 c1 = vec3(0.1050930431085774, 1.404613529898575, 1.384590162594685);","const vec3 c2 = vec3(-0.3308618287255563, 0.214847559468213, 0.09509516302823659);","const vec3 c3 = vec3(-4.634230498983486, -5.799100973351585, -19.33244095627987);","const vec3 c4 = vec3(6.228269936347081, 14.17993336680509, 56.69055260068105);","const vec3 c5 = vec3(4.776384997670288, -13.74514537774601, -65.35303263337234);","const vec3 c6 = vec3(-5.435455855934631, 4.645852612178535, 26.3124352495832);","return c0+t*(c1+t*(c2+t*(c3+t*(c4+t*(c5+t*c6)))));","}","vec3 plasma(float t) {","const vec3 c0 = vec3(0.05873234392399702, 0.02333670892565664, 0.5433401826748754);","const vec3 c1 = vec3(2.176514634195958, 0.2383834171260182, 0.7539604599784036);","const vec3 c2 = vec3(-2.689460476458034, -7.455851135738909, 3.110799939717086);","const vec3 c3 = vec3(6.130348345893603, 42.3461881477227, -28.51885465332158);","const vec3 c4 = vec3(-11.10743619062271, -82.66631109428045, 60.13984767418263);","const vec3 c5 = vec3(10.02306557647065, 71.41361770095349, -54.07218655560067);","const vec3 c6 = vec3(-3.658713842777788, -22.93153465461149, 18.19190778539828);","return c0+t*(c1+t*(c2+t*(c3+t*(c4+t*(c5+t*c6)))));","}","vec3 magma(float t) {","const vec3 c0 = vec3(-0.002136485053939582, -0.000749655052795221, -0.005386127855323933);","const vec3 c1 = vec3(0.2516605407371642, 0.6775232436837668, 2.494026599312351);","const vec3 c2 = vec3(8.353717279216625, -3.577719514958484, 0.3144679030132573);","const vec3 c3 = vec3(-27.66873308576866, 14.26473078096533, -13.64921318813922);","const vec3 c4 = vec3(52.17613981234068, -27.94360607168351, 12.94416944238394);","const vec3 c5 = vec3(-50.76852536473588, 29.04658282127291, 4.23415299384598);","const vec3 c6 = vec3(18.65570506591883, -11.48977351997711, -5.601961508734096);","return c0+t*(c1+t*(c2+t*(c3+t*(c4+t*(c5+t*c6)))));","}","vec3 inferno(float t) {","const vec3 c0 = vec3(0.0002189403691192265, 0.001651004631001012, -0.01948089843709184);","const vec3 c1 = vec3(0.1065134194856116, 0.5639564367884091, 3.932712388889277);","const vec3 c2 = vec3(11.60249308247187, -3.972853965665698, -15.9423941062914);","const vec3 c3 = vec3(-41.70399613139459, 17.43639888205313, 44.35414519872813);","const vec3 c4 = vec3(77.162935699427, -33.40235894210092, -81.80730925738993);","const vec3 c5 = vec3(-71.31942824499214, 32.62606426397723, 73.20951985803202);","const vec3 c6 = vec3(25.13112622477341, -12.24266895238567, -23.07032500287172);","return c0+t*(c1+t*(c2+t*(c3+t*(c4+t*(c5+t*c6)))));","}","vec3 temperature(float t) {","float red = clamp(4. * t - 2., 0., 1.);","float green = 1. - clamp(4. * abs(t - 0.5) - 1., 0., 1.);","float blue = 1. - clamp(4. * t - 1., 0., 1.);","return vec3(red, green, blue);","}","vec3 grey(float t) {","float red = (1.0 - t);","float green = (1.0 - t);","float blue = (1.0 - t);","return vec3(red, green, blue);","}","vec3 greywithred(float t) {","float red;","float green;","float blue;","float normT = normValue(t);","if (t < 0.0) {","red = 1.0;","green = normT;","blue = normT;","} else {","red = (1.0 - normT);","green = (1.0 - normT);","blue = (1.0 - normT);","}","return vec3(red, green, blue);","}","void main() {","vec4 color = texture2D(data, vUv);","vec4 c;","if (cmap == 0) {","c = vec4(viridis(normValue(color.r)).rgb, color.a);","} else if (cmap == 1) {","c = vec4(plasma(normValue(color.r)).rgb, color.a);","} else if (cmap == 2) {","c = vec4(magma(normValue(color.r)).rgb, color.a);","} else if (cmap == 3) {","c = vec4(inferno(normValue(color.r)).rgb, color.a);","} else if (cmap == 4) {","c = vec4(temperature(normValue(color.r)).rgb, color.a);","} else if (cmap == 5) {","c = vec4(grey(normValue(color.r)).rgb, color.a);","} else if (cmap == 6) {","c = vec4(greywithred(color.r).rgb, color.a);","} else  {","c = vec4(viridis(normValue(color.r)).rgb, color.a);","}","gl_FragColor = c;","}"].join("\n")},We={uniforms:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D data;","varying vec2 vUv;","void main() {","vec4 color = texture2D(data, vUv);","vec3 c = color.rgb;","c.r = color.r;","c.g = color.g;","c.b = color.b;","gl_FragColor = vec4(c.rgb, color.a);","}"].join("\n")},Ae=(["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),["uniform float amount;","uniform sampler2D data;","uniform float cmap_min;","uniform float cmap_max;","varying vec2 vUv;","void main() {","vec4 color = texture2D(data, vUv);","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n"),function e(t){var a=this;Object(T.a)(this,e),this.show=function(){a.dom.style.display="inline"},this.hide=function(){a.dom.style.display="none"},this.setPosition=function(e,t){a.dom.style.left="".concat(e,"px"),a.dom.style.top="".concat(t,"px")},this.dom=document.createElement("span"),Object.assign(this.dom.style,{position:"absolute",background:"rgba(0, 0, 0, 0.6)",padding:"0.5em","border-radius":"4px",color:"rgba(255, 255, 255, 1)",display:"inline","user-select":"none","pointer-events":"none"}),this.dom.className=t,window.addEventListener("mousemove",function(e){"imageview-canvas"!==e.target.id&&a.hide()})});var Be=function(){function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";Object(T.a)(this,e),this.setImageHdr=function(e,a,n,i,r,o,c,l,s,m,u){t.imageHDR.beamCX=e,t.imageHDR.beamCY=a,t.imageHDR.pxpmmX=n,t.imageHDR.pxpmmY=i,t.imageHDR.detector_distance=r,t.imageHDR.detector_radius=o,t.imageHDR.wavelength=c,t.imageHDR.min=l,t.imageHDR.max=s,t.imageHDR.mean=m,t.imageHDR.std=u},this.setValueRange=function(e,a){t.cmap_min=e,t.cmap_max=a,t.dataMaterial&&(t.dataMaterial.uniforms.cmap_min.value=e,t.dataMaterial.uniforms.cmap_max.value=a,t.dataMaterial.needsUpdate=!0,t.scene.needsUpdate=!0,t.render.needsUpdate=!0)},this.setValueLimitRange=function(e,a){t.valueLimitRange=[e,a]},this.setColormap=function(e){t.cmap=e,t.dataMaterial&&(t.dataMaterial.uniforms.cmap.value=e,t.dataMaterial.needsUpdate=!0,t.scene.needsUpdate=!0,t.render.needsUpdate=!0)},this.showDiffractionRings=function(e){t.renderRings=e,t.diffraction_rings.forEach(function(t){t.position.z=e?1:-1,t.needsUpdate=!0}),t.scene.needsUpdate=!0},this.init=function(e){t.container=e,t.mouseOverInfoDiv=new Ae("imgeview-info-div"),t.container.appendChild(t.mouseOverInfoDiv.dom),t.initD3(),t.initThree(t.container.clientWidth,t.container.clientHeight),t.initPanAndZoom(),t.renderer.domElement.addEventListener("mousemove",function(e){t.handleMouseMove(e)})},this.initD3=function(){Ue.b(t.container).append("svg").attr("id","d3-container").attr("width",t.container.clientWidth).attr("height",t.container.clientHeight).attr("style","position: absolute; pointer-events: none;"),t.d3Container=Ue.b("#d3-container")},this.initThree=function(e,a){t.renderer=new Se.v,t.width=e,t.height=a,t.renderer.setSize(e,a),t.renderer.setPixelRatio(window.devicePixelRatio),t.container.appendChild(t.renderer.domElement),t.renderer.domElement.id="imageview-canvas",t.stats=new Fe.a,t.stats.dom.style.position="absolute",t.stats.dom.style.bottom="0px",t.stats.dom.style.right="0px",t.stats.dom.style.left=null,t.stats.dom.style.top=null,t.container.appendChild(t.stats.dom),t.camera=new Se.l(0,e,a,0,0,1e3),t.camera.position.set(0,0,100),t.scene=new Se.o,t.scene.background=new Se.c(16777215),t.animateThree()},this.initPanAndZoom=function(){t.d3zoom=Ue.c().scaleExtent([0,1e4]).on("zoom",function(){var e=Ue.a;if(e.sourceEvent){var a=e.transform.k;if(a!==t.camera.zoom)t.camera.zoom=a,t.camera.updateProjectionMatrix();else{var n=e.sourceEvent,i=n.movementX,r=n.movementY;t.camera.position.set(t.camera.position.x-i,t.camera.position.y+r,t.camera.position.z)}t.camera.needsUpdate=!0}}),t.d3view=Ue.b(t.renderer.domElement),t.d3view.call(t.d3zoom)},this.handleMouseMove=function(e){var a=t.renderer.domElement.getBoundingClientRect(),n=e.clientX-Math.floor(a.x),i=e.clientY-Math.floor(a.y),r=new Se.n,o=new Se.u;o.x=n/a.width*2-1,o.y=-i/a.height*2+1,r.setFromCamera(o,t.camera);var c=r.intersectObjects(t.scene.children);if(t.mouseOverInfoDiv.hide(),c.length>0&&void 0!==c[0].uv){var l=c[0],s=Math.floor(l.uv.x*t.imageWidth),m=Math.floor((1-l.uv.y)*t.imageHeight),u=m*t.imageWidth+s,d=t.data[u],v=function(e,t,a,n){var i=Math.sqrt(e*e+t*t)*Math.PI;return n/(2*Math.sin(.5*Math.atan(i/a)))}((t.imageWidth/2+t.imageHDR.beamCX-s)/t.imageHDR.pxpmmX,(t.imageHeight/2+t.imageHDR.beamCY-m)/t.imageHDR.pxpmmY,t.imageHDR.detector_distance,t.imageHDR.wavelength).toFixed(2);t.mouseOverInfoDiv.dom.innerHTML="X:".concat(s," Y:").concat(m," <br /> Intensity: ").concat(d," <br /> Resolution ").concat(v),t.mouseOverInfoDiv.show(),t.mouseOverInfoDiv.setPosition(e.clientX,e.clientY)}},this.scale=function(e){t.d3zoom.scaleTo(t.d3view,e),t.camera.zoom=e,t.camera.updateProjectionMatrix()},this.resetScale=function(){t.scale(t.container.clientHeight/t.imageHeight)},this.relativeScale=function(e){t.scale(t.camera.zoom+e)},this.animateThree=function(){t.renderer.render(t.scene,t.camera),t.stats.update(),window.requestAnimationFrame(t.animateThree)},this.createUVMapping=function(e){e.computeBoundingBox();var t=e.boundingBox.max,a=e.boundingBox.min,n=new Se.u(0-a.x,0-a.y),i=new Se.u(t.x-a.x,t.y-a.y);e.faceVertexUvs[0]=[];for(var r=e.faces,o=0;o<e.faces.length;o+=1){var c=e.vertices[r[o].a],l=e.vertices[r[o].b],s=e.vertices[r[o].c];e.faceVertexUvs[0].push([new Se.u((c.x+n.x)/i.x,(c.y+n.y)/i.y),new Se.u((l.x+n.x)/i.x,(l.y+n.y)/i.y),new Se.u((s.x+n.x)/i.x,(s.y+n.y)/i.y)])}e.uvsNeedUpdate=!0},this.createGlCricle=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=new Se.g({color:16777215,linewidth:1}),r=new Se.a(e,100,0,3*Math.PI),o=new Se.f(r,i);return r.vertices.shift(),o.position.x=t.container.clientWidth/2+a,o.position.y=t.container.clientHeight/2+n,o.position.z=-1,o.needsUpdate=!0,o},this.renderImageData=function(e,a,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";t.data=e,t.imageWidth=a,t.imageHeight=n,t.clearThree(t.scene),t.scene.dispose();var r=new Se.q;r.moveTo(0,0),r.lineTo(0,n),r.lineTo(a,n),r.lineTo(a,0),r.lineTo(0,0),t.geometry=new Se.r(r),t.createUVMapping(t.geometry);var o=Se.t,c=Se.m,l=t.shader;"float32"===i?(o=Se.e,c=Se.i,l=Pe):l=We,t.dataTexture=new Se.d(e,a,n,c,o,Se.s),t.dataTexture.flipY=!0,t.dataTexture.needsUpdate=!0,t.dataTexture.wrapS=Se.b,t.dataTexture.wrapT=Se.b,t.dataTexture.magFilter=Se.k,t.dataTexture.minFilter=Se.h,t.dataMaterial=new Se.p({transparent:!0,uniforms:{cmap:{value:t.cmap},cmap_min:{value:t.cmap_min},cmap_max:{value:t.cmap_max},data:{value:t.dataTexture}},vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}),t.dataMaterial.needsUpdate=!0,t.mesh=new Se.j(t.geometry,t.dataMaterial),t.mesh.geometry.center(),t.scale(t.container.clientHeight/n),t.mesh.position.x=t.container.clientWidth/2,t.mesh.position.y=t.container.clientHeight/2,t.mesh.needsUpdate=!0,t.scene.add(t.mesh),t.diffraction_rings=t.createDiffractionRings(),t.diffraction_rings.forEach(function(e){return t.scene.add(e)}),t.renderRings&&t.showDiffractionRings(!0),t.scene.needsUpdate=!0},this.render=function(e,a,n){t.setImageHdr(a.beam_ocx,a.beam_ocy,a.pxxpm,a.pxypm,a.detector_distance,a.detector_radius,a.wavelength,a.min,a.max,a.mean,a.std),t.renderImageData(e,a.img_width,a.img_height,n)},Le[a]=this,this.shader=Pe,this.cmap_min=0,this.cmap_max=1,this.cmap=0,this.valueLimitRange=[0,0],this.renderRings=!1,this.data=null,this.imageWidth=null,this.imageHeight=null,this.imageHDR={beamCX:0,beamCY:0,pxpmmX:0,pxpmmY:0,detector_distance:0,detector_radius:0,wavelength:0,min:0,max:0,mean:0,std:0},this.width=null,this.height=null,this.currentScale=null,this.stats=null,this.scene=null,this.camera=null,this.renderer=null,this.d3view=null,this.d3Container=null}return Object(H.a)(e,[{key:"clearThree",value:function(e){for(;e.children.length>0;)this.clearThree(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose(),e.mesh&&e.mesh.dispose(),e.texture&&e.texture.dispose()}},{key:"createDiffractionRings",value:function(){var e=this,t=function(e,t,a){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.03,i=[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01;r<=e;r+=n){var o=r*Math.PI,c=a/(2*Math.sin(.5*Math.atan(o/t)));i.push({r:r,res:c})}return i}(this.imageHDR.detector_radius,this.imageHDR.detector_distance,this.imageHDR.wavelength).map(function(t){return e.createGlCricle(t.r*e.imageHDR.pxpmmX,-e.imageHDR.beamCX,-e.imageHDR.beamCY)});return t.push(this.createGlCricle(5,-this.imageHDR.beamCX,-this.imageHDR.beamCY)),t}}]),e}();Be.VIEWS={};var Xe=function(e){function t(e){var a;return Object(T.a)(this,t),(a=Object(te.a)(this,Object(ae.a)(t).call(this,e))).availableColormaps=function(){var e=[];return a.imageView&&(e=Object.keys(a.imageView.shader.cmaps)),e},a.renderToolBox=function(){var e,t=a.state.toolboxVisible,n=null;a.imageView&&(n=c.a.createElement("div",{className:"toolbox ".concat(t?"toolbox-visible":"")},c.a.createElement(ke.a,{variant:"flush",className:"".concat(t?"toolbox-visible":"")},c.a.createElement(ke.a.Item,null,c.a.createElement("h4",null,c.a.createElement("small",{className:"text-muted"},"Info")),c.a.createElement(Ce.a,null,c.a.createElement(Ve.a,{xs:"4"},"Det. distance:"),c.a.createElement(Ve.a,{xs:"2"},a.imageView.imageHDR.detector_distance.toFixed(4)),c.a.createElement(Ve.a,{xs:"4"},"Wavelength"),c.a.createElement(Ve.a,{xs:"2"},a.imageView.imageHDR.wavelength.toFixed(4))),c.a.createElement(Ce.a,null,c.a.createElement(Ve.a,{xs:"4"},"Min:"),c.a.createElement(Ve.a,{xs:"2"},a.imageView.imageHDR.min),c.a.createElement(Ve.a,{xs:"4"},"Mean:"),c.a.createElement(Ve.a,{xs:"2"},a.imageView.imageHDR.mean.toFixed(2))),c.a.createElement(Ce.a,null,c.a.createElement(Ve.a,{xs:"4"},"Max:"),c.a.createElement(Ve.a,{xs:"2"},a.imageView.imageHDR.max),c.a.createElement(Ve.a,{xs:"4"},"Std:"),c.a.createElement(Ve.a,{xs:"2"},a.imageView.imageHDR.std.toFixed(2)))),c.a.createElement(ke.a.Item,null,c.a.createElement("h4",null,c.a.createElement("small",{className:"text-muted"},"Options")),c.a.createElement(Ie.a.Group,null,c.a.createElement(Ie.a.Check,{checked:a.imageView.renderRings,type:"checkbox",label:"Show diffraction rings",onChange:function(e){a.imageView.showDiffractionRings(e.target.checked),a.forceUpdate()}}))),c.a.createElement(ke.a.Item,null,c.a.createElement("h4",null,c.a.createElement("small",{className:"text-muted"},"Colormap")),c.a.createElement(Ie.a,null,c.a.createElement(Ie.a.Group,null,c.a.createElement(Ie.a.Control,{as:"select",onChange:function(e){a.imageView.setColormap(e.target.selectedIndex)}},a.availableColormaps().map(function(e){return c.a.createElement("option",null,e)}))),c.a.createElement(Ie.a.Group,null,c.a.createElement(Ie.a.Label,null,"Value range"),c.a.createElement(Me.a.Range,{min:a.imageView.valueLimitRange[0],max:a.imageView.valueLimitRange[1],marks:(e={},Object(w.a)(e,a.imageView.valueLimitRange[0],"min"),Object(w.a)(e,a.imageView.valueLimitRange[1],"max"),e),step:1,value:[a.imageView.cmap_min,a.imageView.cmap_max],onChange:function(e){a.imageView.setValueRange(e[0],e[1]),a.forceUpdate()}})),c.a.createElement(Ie.a.Row,null,c.a.createElement(Ie.a.Group,{as:Ve.a,xs:"3"},c.a.createElement(Te.a,{size:3,max:a.imageView.imageHDR.max-1,min:a.imageView.imageHDR.min,value:Math.floor(a.imageView.valueLimitRange[0]),onChange:function(e){var t=Math.floor(parseInt(e,10));Number.isNaN(t)||(a.imageView.setValueLimitRange(t,a.imageView.valueLimitRange[1]),a.forceUpdate())}})),c.a.createElement(Ve.a,{className:"col-xs-auto text-center"},"Range ".concat(Math.floor(a.imageView.cmap_min)," - ").concat(Math.floor(a.imageView.cmap_max))),c.a.createElement(Ie.a.Group,{as:Ve.a,xs:"3"},c.a.createElement(Te.a,{size:3,max:a.imageView.imageHDR.max,min:a.imageView.imageHDR.min+1,value:Math.floor(a.imageView.valueLimitRange[1]),onChange:function(e){var t=Math.floor(parseInt(e,10));Number.isNaN(t)||(a.imageView.setValueLimitRange(a.imageView.valueLimitRange[0],t),a.forceUpdate())}}))))))));return n},a.imageView=new Be,a.canvasContainerRef=c.a.createRef(),a.state={toolboxVisible:!1},a}return Object(ne.a)(t,e),Object(H.a)(t,[{key:"componentDidMount",value:function(){this.imageView.init(this.canvasContainerRef.current)}},{key:"render",value:function(){var e=this,t=this.state.toolboxVisible;return c.a.createElement("div",{className:"imageview"},c.a.createElement("div",{className:"toolbar",id:"imageview-menu"},c.a.createElement(He.b,{onClick:function(){e.imageView.relativeScale(-.1)}}),c.a.createElement(He.a,{onClick:function(){e.imageView.resetScale()}}),c.a.createElement(He.c,{onClick:function(){e.imageView.relativeScale(.1)}}),c.a.createElement(He.d,{onClick:function(){e.setState({toolboxVisible:!t})}})),this.renderToolBox(),c.a.createElement("div",{id:"imageview-container",ref:this.canvasContainerRef,className:"image"}))}}]),t}(c.a.Component),Ge=function(e){function t(){var e,a;Object(T.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(te.a)(this,(e=Object(ae.a)(t)).call.apply(e,[this].concat(i)))).log10=function(e){return[Math.log(e[0])/Math.log(10),Math.log(e[1])/Math.log(10)]},a.pow10=function(e){return Math.pow(e,10)},a.valueLabelFormat=function(e){var t=a.pow10(e).toExponential().split("e").map(function(e){return Number(e)}),n=Object(re.a)(t,2),i=n[0],r=n[1];return"".concat(Math.round(i),"e^").concat(r)},a}return Object(ne.a)(t,e),Object(H.a)(t,[{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.images,n=e.app,i=e.fetchImageRequest,r=e.currentImagePath,o=c.a.createElement("div",null,c.a.createElement(le.a,null,c.a.createElement(De,{onFileClick:i,downloadedFiles:a})));return c.a.createElement("div",{className:t.root},c.a.createElement(oe.a,null),c.a.createElement(ce.a,{variant:"persistent",anchor:"left",className:t.drawer,classes:{paper:t.drawerPaper},open:!n.follow},o),c.a.createElement(se.a,{className:t.snackBar,open:n.follow,onClose:this.handleClose,TransitionComponent:me.a,ContentProps:{"aria-describedby":"message-id"},message:c.a.createElement("span",{id:"message-id"},"Following:",r)}),c.a.createElement("main",{className:t.content},c.a.createElement("div",{className:t.imageViewContainer},c.a.createElement(Xe,{currentImage:r}))))}}]),t}(c.a.Component);var Ye=Object(s.c)(function(e){var t=e.imageView,a=e.app;return{options:t.options,currentImagePath:t.currentImage,images:t.images,app:a}},function(e){return Object(u.b)(i,e)})(Object(ue.a)(function(e){return{root:{display:"flex"},drawer:{width:300},drawerPaper:{width:300},appBar:{zIndex:e.zIndex.drawer+1,background:"#ffffff"},content:{padding:3*e.spacing.unit},optionsForm:{padding:2*e.spacing.unit},imageViewContainer:{position:"absolute",left:"10px",right:"10px",top:"10px",bottom:"10px",overflow:"hidden"},toolbar:e.mixins.toolbar,snackBar:{bottom:"2em"},menuButton:{position:"fixed",zIndex:1,right:"0.5em",top:"0.5em"},hide:{display:"none"}}},{withTheme:!0})(Ge)),qe=(a(458),function(e){function t(){return Object(T.a)(this,t),Object(te.a)(this,Object(ae.a)(t).apply(this,arguments))}return Object(ne.a)(t,e),Object(H.a)(t,[{key:"render",value:function(){return c.a.createElement("div",{className:"app"},c.a.createElement("div",null,c.a.createElement(ie.a,{exact:!0,path:"/",component:Ye})))}}]),t}(o.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Je=a(237),Ze=a.n(Je),$e=a(238),Ke=a.n($e),Qe=a(239),et=a.n(Qe);a(484),a(486);!function(e){var t=Ze.a.connect("http://".concat(document.domain,":").concat(window.location.port),{path:"/api/socket.io/"});e.dispatch(M()),t.on("connect",function(){return console.log("connect")}),t.on("show-image",function(t){e.dispatch(G(t.path))}),t.on("set-follow",function(t){var a,n,i,r;e.dispatch((a=t.follow,n=t.wavelength,i=t.detector_distance,r=t.detector_radius,function(e){e({type:Y,follow:a,detectorDistance:i,detectorRadius:r,wavelength:n})}))}),t.on("disconnect",function(){return console.log("disconnect")}),window.fullDataDownloadWorker=new Ke.a,window.previewDataDownloadWorker=new et.a,window.fullDataDownloadWorker.onmessage=function(t){var a=e.getState().app.follow,n=e.getState().imageView.options.downloadFull;if(!a&&n){var i=S.get(t.data.path).hdr,r=t.data.data;S.add(t.data.path,"raw",r),ze("default").render(r,i,"float32"),ze("default").setValueRange(i.min,10*i.mean),ze("default").setValueLimitRange(i.min,3*i.std),e.dispatch(z(t.data.path,i))}},window.previewDataDownloadWorker.onmessage=function(t){var a=e.getState().app.follow,n=e.getState().imageView.options.downloadFull;if(a||!n){var i=S.get(t.data.path).hdr,r=t.data.data;S.add(t.data.path,"preview",r),ze("default").render(r,i,"int32"),e.dispatch(z(t.data.path,i))}}}(ee);var tt=document.querySelector("#root");Object(l.render)(c.a.createElement(s.a,{store:ee},c.a.createElement(m.a,{history:$},c.a.createElement(qe,null))),tt),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[254,2,1]]]);
//# sourceMappingURL=main.40fb7864.chunk.js.map